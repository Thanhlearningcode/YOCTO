[{"id": "content/1-gi-i-thi-u-v-yocto-project.md", "title": "T·∫ßm quan tr·ªçng c·ªßa Yocto trong ph√°t tri·ªÉn nh√∫ng", "body": "# T·∫ßm quan tr·ªçng c·ªßa Yocto trong ph√°t tri·ªÉn nh√∫ng\n\nYocto Project gi√∫p gi·∫£i quy·∫øt m·ªôt s·ªë v·∫•n ƒë·ªÅ ch√≠nh trong ph√°t tri·ªÉn h·ªá ƒëi·ªÅu h√†nh cho thi·∫øt b·ªã nh√∫ng:\n\n- **T√≠nh linh ho·∫°t**: Yocto cho ph√©p t√πy ch·ªânh t·ª´ bootloader, kernel ƒë·∫øn user space, t·ª´ ƒë√≥ d·ªÖ d√†ng t·∫°o ra h·ªá ƒëi·ªÅu h√†nh ph√π h·ª£p cho c√°c thi·∫øt b·ªã c√≥ y√™u c·∫ßu ph·∫ßn c·ª©ng ri√™ng bi·ªát.  \n- **T√°i s·ª≠ d·ª•ng m√£ ngu·ªìn**: Yocto h·ªó tr·ª£ vi·ªác t√°i s·ª≠ d·ª•ng c√°c th√†nh ph·∫ßn t·ª´ c√°c d·ª± √°n m√£ ngu·ªìn m·ªü, gi√∫p ti·∫øt ki·ªám th·ªùi gian v√† chi ph√≠ ph√°t tri·ªÉn.  \n- **Kh·∫£ nƒÉng m√¥ ƒëun h√≥a**: V·ªõi c√°c meta-layer v√† recipe, Yocto gi√∫p qu·∫£n l√Ω, m·ªü r·ªông v√† ph√°t tri·ªÉn h·ªá th·ªëng m·ªôt c√°ch hi·ªáu qu·∫£, t√°ch bi·ªát c√°c th√†nh ph·∫ßn theo t·ª´ng l·ªõp ch·ª©c nƒÉng.  \n- **Kh·∫£ nƒÉng t√≠ch h·ª£p CI/CD**: Yocto c√≥ th·ªÉ t√≠ch h·ª£p v·ªõi c√°c h·ªá th·ªëng Continuous Integration/Continuous Deployment (CI/CD) ƒë·ªÉ gi√∫p t·ª± ƒë·ªông h√≥a v√† ki·ªÉm tra qu√° tr√¨nh x√¢y d·ª±ng h·ªá ƒëi·ªÅu h√†nh.  \n\n---\n\n# C√°c th√†nh ph·∫ßn ch√≠nh c·ªßa Yocto Project\n\n## 2.1. BitBake\nBitBake l√† c√¥ng c·ª• ch√≠nh trong Yocto Project ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ qu·∫£n l√Ω v√† th·ª±c hi·ªán vi·ªác build h·ªá ƒëi·ªÅu h√†nh. N√≥ c√≥ nhi·ªám v·ª• x·ª≠ l√Ω c√°c recipes (c√¥ng th·ª©c x√¢y d·ª±ng ph·∫ßn m·ªÅm), ƒëi·ªÅu ph·ªëi vi·ªác bi√™n d·ªãch m√£ ngu·ªìn, t·∫°o h·ªá th·ªëng t·∫≠p tin, v√† c√°c th√†nh ph·∫ßn kh√°c c·ªßa h·ªá ƒëi·ªÅu h√†nh.\n\n- **Qu·∫£n l√Ω Dependency**: BitBake x√°c ƒë·ªãnh c√°c ph·ª• thu·ªôc gi·ªØa c√°c th√†nh ph·∫ßn v√† ƒë·∫£m b·∫£o ch√∫ng ƒë∆∞·ª£c x√¢y d·ª±ng ƒë√∫ng th·ª© t·ª±.  \n- **T√≠nh module h√≥a**: BitBake h·ªó tr·ª£ vi·ªác x√¢y d·ª±ng h·ªá ƒëi·ªÅu h√†nh d∆∞·ªõi d·∫°ng module, d·ªÖ d√†ng th√™m, lo·∫°i b·ªè ho·∫∑c thay ƒë·ªïi c√°c th√†nh ph·∫ßn.  \n\n## 2.2. Recipe\nRecipe l√† c√°c t·ªáp tin m√¥ t·∫£ c√°ch bi√™n d·ªãch v√† c√†i ƒë·∫∑t m·ªôt g√≥i ph·∫ßn m·ªÅm trong Yocto Project. M·ªói recipe ch·ª©a c√°c h∆∞·ªõng d·∫´n nh∆∞:\n\n- Ngu·ªìn m√£ ngu·ªìn (**SRC_URI**)  \n- C√°ch bi√™n d·ªãch (**do_compile**)  \n- C√°ch c√†i ƒë·∫∑t (**do_install**)  \n\nC√°c recipe c√≥ ph·∫ßn m·ªü r·ªông `.bb` v√† l√† th√†nh ph·∫ßn quan tr·ªçng gi√∫p BitBake hi·ªÉu c√°ch bi√™n d·ªãch m·ªôt ph·∫ßn m·ªÅm.\n\n## 2.3. Layer (meta layer)\nLayers (meta-layers) l√† c√°ch Yocto Project t·ªï ch·ª©c v√† qu·∫£n l√Ω c√°c th√†nh ph·∫ßn c·ªßa h·ªá ƒëi·ªÅu h√†nh. M·ªói layer ch·ª©a c√°c recipe, patch, v√† c·∫•u h√¨nh li√™n quan ƒë·∫øn m·ªôt b·ªô ch·ª©c nƒÉng ho·∫∑c m·ªôt lo·∫°i ph·∫ßn c·ª©ng c·ª• th·ªÉ.\n\n- **Meta-layer**: C√≥ th·ªÉ ch·ª©a c·∫•u h√¨nh ph·∫ßn c·ª©ng (vd: meta-raspberrypi), ph·∫ßn m·ªÅm (vd: meta-openembedded), ho·∫∑c layer ri√™ng c·ªßa d·ª± √°n.  \n- **Layer Priority**: Yocto cho ph√©p s·∫Øp x·∫øp ∆∞u ti√™n c√°c layer ƒë·ªÉ ghi ƒë√® ho·∫∑c m·ªü r·ªông c√°c th√†nh ph·∫ßn.  \n\n## 2.4. Config File\nConfig file g·ªìm c√°c t·ªáp c·∫•u h√¨nh thi·∫øt l·∫≠p m√¥i tr∆∞·ªùng build:  \n\n- **local.conf**: Thi·∫øt l·∫≠p li√™n quan ƒë·∫øn m√°y ƒë√≠ch, s·ªë lu·ªìng CPU ƒë·ªÉ build, ...  \n- **bblayers.conf**: X√°c ƒë·ªãnh c√°c layer m√† BitBake s·∫Ω s·ª≠ d·ª•ng trong qu√° tr√¨nh build.  \n\n## 2.5. Metadata\nMetadata ch·ª©a t·∫•t c·∫£ th√¥ng tin v√† ch·ªâ th·ªã v·ªÅ c√°ch bi√™n d·ªãch v√† c·∫•u tr√∫c h·ªá ƒëi·ªÅu h√†nh. Metadata c√≥ th·ªÉ n·∫±m trong recipe, layer, v√† c√°c t·ªáp c·∫•u h√¨nh kh√°c.\n\n## 2.6. Class\nClass (`.bbclass`) ch·ª©a c√°c ƒëo·∫°n m√£ d√πng chung ƒë·ªÉ s·ª≠ d·ª•ng trong nhi·ªÅu recipe. V√≠ d·ª•: `autotools.bbclass` cung c·∫•p l·ªánh ƒë·ªÉ build ph·∫ßn m·ªÅm d√πng autotools.\n\n## 2.7. BitBake File\nBitBake file l√† c√°c t·ªáp recipe v·ªõi ph·∫ßn m·ªü r·ªông `.bb`. C√°c file `.bbappend` c√≥ th·ªÉ m·ªü r·ªông ho·∫∑c ghi ƒë√® recipe s·∫µn c√≥.\n\n## 2.8. Package\nPackage l√† k·∫øt qu·∫£ ƒë·∫ßu ra c·ªßa qu√° tr√¨nh bi√™n d·ªãch trong Yocto. BitBake s·∫Ω t·∫°o package d∆∞·ªõi d·∫°ng `.ipk`, `.deb`, ho·∫∑c `.rpm`.\n\n## 2.9. OpenEmbedded\nOpenEmbedded l√† framework c∆° b·∫£n m√† Yocto Project s·ª≠ d·ª•ng, cung c·∫•p meta-layers, recipes v√† th∆∞ vi·ªán phong ph√∫ ƒë·ªÉ x√¢y d·ª±ng g√≥i ph·∫ßn m·ªÅm.\n\n---\n\n# 3. K·∫øt lu·∫≠n\nYocto Project l√† c√¥ng c·ª• quan tr·ªçng trong ph√°t tri·ªÉn h·ªá ƒëi·ªÅu h√†nh nh√∫ng. C√°c th√†nh ph·∫ßn nh∆∞ Poky, BitBake, layer v√† recipe gi√∫p qu·∫£n l√Ω h·ªá th·ªëng c√≥ t·ªï ch·ª©c, d·ªÖ t√πy ch·ªânh, ph√π h·ª£p cho t·ª´ng y√™u c·∫ßu ph·∫ßn c·ª©ng v√† ph·∫ßn m·ªÅm c·ªßa thi·∫øt b·ªã nh√∫ng.\n"}, {"id": "content/10-c-c-l-i-th-ng-g-p-khi-ph-t-tri-n-v-i-yocto-project-v-c-ch-kh-c-ph-c.md", "title": "Ki·ªÉm tra locale hi·ªán t·∫°i", "body": "Yocto Project l√† m·ªôt c√¥ng c·ª• m·∫°nh m·∫Ω ƒë·ªÉ x√¢y d·ª±ng h·ªá th·ªëng Linux t√πy ch·ªânh cho c√°c thi·∫øt b·ªã nh√∫ng. Tuy nhi√™n, do t√≠nh ph·ª©c t·∫°p v√† s·ª± ph·ª• thu·ªôc v√†o nhi·ªÅu th√†nh ph·∫ßn, c√°c nh√† ph√°t tri·ªÉn th∆∞·ªùng g·∫∑p ph·∫£i nhi·ªÅu lo·∫°i l·ªói kh√°c nhau. B√†i vi·∫øt n√†y s·∫Ω ph√¢n t√≠ch c√°c l·ªói ph·ªï bi·∫øn nh·∫•t khi l√†m vi·ªác v·ªõi Yocto Project v√† cung c·∫•p h∆∞·ªõng d·∫´n chi ti·∫øt ƒë·ªÉ kh·∫Øc ph·ª•c ch√∫ng.\n\n1. L·ªói thi·∫øt l·∫≠p m√¥i tr∆∞·ªùng\n1.1. L·ªói \"Command not found\" khi ch·∫°y bitbake\nTri·ªáu ch·ª©ng:\n\n$ bitbake core-image-minimal\nbash: bitbake: command not found\nüìã Copy\nNguy√™n nh√¢n: M√¥i tr∆∞·ªùng Yocto ch∆∞a ƒë∆∞·ª£c thi·∫øt l·∫≠p ƒë√∫ng c√°ch.\n\nGi·∫£i ph√°p:\n\n$ source oe-init-build-env [build-directory]\nüìã Copy\n1.2. L·ªói \"Please use a locale setting which supports UTF-8\"\nTri·ªáu ch·ª©ng:\n\nPlease use a locale setting which supports UTF-8 (such as LANG=en_US.UTF-8).\nPython can't change the filesystem locale after loading so we need a UTF-8\nlocale before startup.\nüìã Copy\nNguy√™n nh√¢n: C√†i ƒë·∫∑t locale kh√¥ng h·ªó tr·ª£ UTF-8.\n\nGi·∫£i ph√°p:\n\n# Ki·ªÉm tra locale hi·ªán t·∫°i\nlocale\n\n# Thi·∫øt l·∫≠p locale UTF-8\nexport LC_ALL=en_US.UTF-8\nexport LANG=en_US.UTF-8\n\n# N·∫øu locale ch∆∞a ƒë∆∞·ª£c c√†i ƒë·∫∑t\nsudo apt-get install locales\nsudo locale-gen en_US.UTF-8\nüìã Copy\n1.3. L·ªói Python kh√¥ng t∆∞∆°ng th√≠ch\nTri·ªáu ch·ª©ng:\n\nThis program requires Python 3.6.0 or greater\nüìã Copy\nNguy√™n nh√¢n: Phi√™n b·∫£n Python kh√¥ng t∆∞∆°ng th√≠ch v·ªõi Yocto.\n\nGi·∫£i ph√°p:\n\n# Ki·ªÉm tra phi√™n b·∫£n Python\npython3 --version\n\n# C√†i ƒë·∫∑t phi√™n b·∫£n Python ph√π h·ª£p\nsudo apt-get install python3.8 python3.8-dev\nüìã Copy\n2. L·ªói t·∫£i m√£ ngu·ªìn (Fetching)\n2.1. L·ªói t·∫£i m√£ ngu·ªìn t·ª´ Git\nTri·ªáu ch·ª©ng:\n\nERROR: Fetcher failure: Unable to find revision abcdef1234567890 in branch master even from upstream\nüìã Copy\nNguy√™n nh√¢n: Kh√¥ng th·ªÉ t√¨m th·∫•y commit c·ª• th·ªÉ ho·∫∑c k·∫øt n·ªëi m·∫°ng c√≥ v·∫•n ƒë·ªÅ.\n\nGi·∫£i ph√°p:\n\n# Ki·ªÉm tra k·∫øt n·ªëi ƒë·∫øn repository\ngit ls-remote <repository-url>\n\n# C·∫≠p nh·∫≠t SRCREV trong recipe\nSRCREV = \"latest-commit-hash\"\n\n# Ho·∫∑c s·ª≠ d·ª•ng AUTOREV (kh√¥ng n√™n d√πng cho production)\nSRCREV = \"${AUTOREV}\"\nüìã Copy\n2.2. L·ªói t·∫£i t·ªáp t·ª´ HTTP/FTP\nTri·ªáu ch·ª©ng:\n\nERROR: Fetcher failure for URL: 'http://example.com/package-1.0.tar.gz'. Unable to fetch URL\nüìã Copy\nNguy√™n nh√¢n: URL kh√¥ng t·ªìn t·∫°i, m√°y ch·ªß kh√¥ng ph·∫£n h·ªìi, ho·∫∑c v·∫•n ƒë·ªÅ m·∫°ng.\n\nGi·∫£i ph√°p:\n\n# Ki·ªÉm tra URL trong tr√¨nh duy·ªát\n# Thay ƒë·ªïi URL trong recipe\nSRC_URI = \"http://mirror-site.com/package-1.0.tar.gz\"\n\n# Ho·∫∑c s·ª≠ d·ª•ng b·∫£n sao c·ª•c b·ªô\nSRC_URI = \"file://local-path/package-1.0.tar.gz\"\nüìã Copy\n2.3. L·ªói checksum\nTri·ªáu ch·ª©ng:\n\nERROR: Checksum mismatch for local file download:/path/to/file.tar.gz\nüìã Copy\nNguy√™n nh√¢n: T·ªáp ƒë√£ t·∫£i xu·ªëng kh√¥ng kh·ªõp v·ªõi checksum ƒë√£ khai b√°o.\n\nGi·∫£i ph√°p:\n\n# C·∫≠p nh·∫≠t checksum trong recipe\nSRC_URI[md5sum] = \"new-md5-checksum\"\nSRC_URI[sha256sum] = \"new-sha256-checksum\"\n\n# Ho·∫∑c t√≠nh to√°n checksum m·ªõi\nmd5sum file.tar.gz\nsha256sum file.tar.gz\nüìã Copy\n3. L·ªói bi√™n d·ªãch (Compilation)\n3.1. L·ªói bi√™n d·ªãch C/C++\nTri·ªáu ch·ª©ng:\n\nERROR: Function failed: do_compile\n| /path/to/file.c:123:45: error: 'struct example' has no member named 'member'\nüìã Copy\nNguy√™n nh√¢n: L·ªói c√∫ ph√°p, th∆∞ vi·ªán thi·∫øu, ho·∫∑c kh√¥ng t∆∞∆°ng th√≠ch.\n\nGi·∫£i ph√°p:\n\n# Ki·ªÉm tra log chi ti·∫øt\nless tmp/work/<package-path>/temp/log.do_compile\n\n# Th√™m patch ƒë·ªÉ s·ª≠a l·ªói\nSRC_URI += \"file://0001-Fix-compilation-error.patch\"\n\n# Th√™m c·ªù bi√™n d·ªãch\nTARGET_CFLAGS += \"-Ddefine_macro\"\n\n# Th√™m th∆∞ vi·ªán ph·ª• thu·ªôc\nDEPENDS += \"required-library\"\nüìã Copy\n3.2. L·ªói autotools\nTri·ªáu ch·ª©ng:\n\nERROR: Function failed: do_configure\n| configure: error: cannot find install-sh, install.sh, or shtool\nüìã Copy\nNguy√™n nh√¢n: C·∫•u h√¨nh autotools kh√¥ng ch√≠nh x√°c.\n\nGi·∫£i ph√°p:\n\n# Th√™m c·ªù c·∫•u h√¨nh\nEXTRA_OECONF += \"--with-feature --disable-option\"\n\n# Ch·∫°y autoreconf\ndo_configure_prepend() {\n    cd ${S}\n    autoreconf -fi\n}\nüìã Copy\n3.3. L·ªói CMake\nTri·ªáu ch·ª©ng:\n\nERROR: Function failed: do_configure\n| CMake Error: Could not find module FindSomeLibrary.cmake\nüìã Copy\nNguy√™n nh√¢n: Thi·∫øu module CMake ho·∫∑c c·∫•u h√¨nh kh√¥ng ch√≠nh x√°c.\n\nGi·∫£i ph√°p:\n\n# Th√™m c·ªù CMake\nEXTRA_OECMAKE += \"-DENABLE_FEATURE=ON -DDISABLE_OPTION=OFF\"\n\n# Cung c·∫•p module b·ªã thi·∫øu\ndo_configure_prepend() {\n    cp ${WORKDIR}/FindSomeLibrary.cmake ${S}/cmake/modules/\n}\nüìã Copy\n4. L·ªói c·∫•u h√¨nh (Configuration)\n4.1. L·ªói MACHINE kh√¥ng x√°c ƒë·ªãnh\nTri·ªáu ch·ª©ng:\n\nERROR: Unable to parse /path/to/conf/local.conf: Could not find a valid MACHINE assignment\nüìã Copy\nNguy√™n nh√¢n: Bi·∫øn MACHINE kh√¥ng ƒë∆∞·ª£c ƒë·∫∑t ho·∫∑c kh√¥ng h·ª£p l·ªá.\n\nGi·∫£i ph√°p:\n\n# Ch·ªânh s·ª≠a conf/local.conf\nMACHINE ?= \"qemux86-64\"  # ho·∫∑c m√°y ƒë√≠ch kh√°c\n\n# Ki·ªÉm tra c√°c m√°y c√≥ s·∫µn\nls meta*/conf/machine/*.conf\nüìã Copy\n4.2. L·ªói layer kh√¥ng t√¨m th·∫•y\nTri·ªáu ch·ª©ng:\n\nERROR: Layer 'meta-custom' not found in the repository\nüìã Copy\nNguy√™n nh√¢n: Layer kh√¥ng t·ªìn t·∫°i ho·∫∑c ch∆∞a ƒë∆∞·ª£c th√™m v√†o bblayers.conf.\n\nGi·∫£i ph√°p:\n\n# Ki·ªÉm tra c√°c layer ƒë√£ c√†i ƒë·∫∑t\nbitbake-layers show-layers\n\n# Th√™m layer m·ªõi\nbitbake-layers add-layer /path/to/meta-custom\n\n# Ho·∫∑c ch·ªânh s·ª≠a conf/bblayers.conf th·ªß c√¥ng\nBBLAYERS += \"/path/to/meta-custom\"\nüìã Copy\n4.3. L·ªói bi·∫øn kh√¥ng x√°c ƒë·ªãnh\nTri·ªáu ch·ª©ng:\n\nERROR: Parsing halted due to errors. The variable UNDEFINED_VARIABLE is not defined\nüìã Copy\nNguy√™n nh√¢n: Bi·∫øn ƒë∆∞·ª£c s·ª≠ d·ª•ng nh∆∞ng kh√¥ng ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a.\n\nGi·∫£i ph√°p:\n\n# ƒê·ªãnh nghƒ©a bi·∫øn trong recipe\nUNDEFINED_VARIABLE = \"value\"\n\n# Ho·∫∑c trong local.conf\nUNDEFINED_VARIABLE ?= \"value\"\nüìã Copy\n5. L·ªói ph·ª• thu·ªôc (Dependencies)\n5.1. L·ªói thi·∫øu ph·ª• thu·ªôc\nTri·ªáu ch·ª©ng:\n\nERROR: Nothing PROVIDES 'missing-dependency'\nüìã Copy\nNguy√™n nh√¢n: Recipe y√™u c·∫ßu m·ªôt ph·ª• thu·ªôc kh√¥ng t·ªìn t·∫°i.\n\nGi·∫£i ph√°p:\n\n# Th√™m recipe cho ph·ª• thu·ªôc b·ªã thi·∫øu\n# Ho·∫∑c s·ª≠a ƒë·ªïi DEPENDS trong recipe\nDEPENDS = \"existing-dependency other-dependency\"\n\n# Ki·ªÉm tra c√°c g√≥i c√≥ s·∫µn\nbitbake-layers show-recipes\nüìã Copy\n5.2. L·ªói xung ƒë·ªôt ph·ª• thu·ªôc\nTri·ªáu ch·ª©ng:\n\nERROR: Multiple .bb files are due to be built which each provide virtual/dependency\nüìã Copy\nNguy√™n nh√¢n: Nhi·ªÅu recipe cung c·∫•p c√πng m·ªôt ph·ª• thu·ªôc ·∫£o.\n\nGi·∫£i ph√°p:\n\n# Ch·ªâ ƒë·ªãnh phi√™n b·∫£n ∆∞u ti√™n trong local.conf\nPREFERRED_PROVIDER_virtual/dependency = \"specific-recipe\"\n\n# Ki·ªÉm tra c√°c provider\nbitbake -e virtual/dependency | grep ^PREFERRED_PROVIDER\nüìã Copy\n5.3. L·ªói phi√™n b·∫£n kh√¥ng t∆∞∆°ng th√≠ch\nTri·ªáu ch·ª©ng:\n\nERROR: No compatible version found for package (wanted version X, available versions Y, Z)\nüìã Copy\nNguy√™n nh√¢n: Phi√™n b·∫£n y√™u c·∫ßu kh√¥ng kh·ªõp v·ªõi phi√™n b·∫£n c√≥ s·∫µn.\n\nGi·∫£i ph√°p:\n\n# Ch·ªâ ƒë·ªãnh phi√™n b·∫£n ∆∞u ti√™n\nPREFERRED_VERSION_package = \"X.Y.Z\"\n\n# Ki·ªÉm tra c√°c phi√™n b·∫£n c√≥ s·∫µn\nbitbake-layers show-recipes package\nüìã Copy\n6. L·ªói recipe v√† layer\n6.1. L·ªói c√∫ ph√°p recipe\nTri·ªáu ch·ª©ng:\n\nERROR: ParseError at /path/to/recipe.bb:10: Could not parse\nüìã Copy\nNguy√™n nh√¢n: L·ªói c√∫ ph√°p trong file recipe.\n\nGi·∫£i ph√°p:\n\n# Ki·ªÉm tra c√∫ ph√°p v·ªõi bitbake-diffsigs\nbitbake-diffsigs recipe-name\n\n# S·ª≠a l·ªói c√∫ ph√°p\n# Th∆∞·ªùng l√† d·∫•u ngo·∫∑c, d·∫•u nh√°y ho·∫∑c d·∫•u ph·∫©y b·ªã thi·∫øu\nüìã Copy\n6.2. L·ªói LICENSE_CHECKSUM\nTri·ªáu ch·ª©ng:\n\nERROR: Recipe uses a deprecated license file md5sum\nüìã Copy\nNguy√™n nh√¢n: Checksum c·ªßa file LICENSE kh√¥ng ch√≠nh x√°c.\n\nGi·∫£i ph√°p:\n\n# C·∫≠p nh·∫≠t checksum\nLIC_FILES_CHKSUM = \"file://LICENSE;md5=new-md5-checksum\"\n\n# T√≠nh to√°n md5sum m·ªõi\nmd5sum path/to/LICENSE\nüìã Copy\n6.3. L·ªói RDEPENDS\nTri·ªáu ch·ª©ng:\n\nERROR: Recipe runtime dependency 'package' not found in any recipe\nüìã Copy\nNguy√™n nh√¢n: Runtime dependency kh√¥ng t·ªìn t·∫°i.\n\nGi·∫£i ph√°p:\n\n# Ki·ªÉm tra t√™n g√≥i ch√≠nh x√°c\nbitbake-layers show-recipes | grep package\n\n# S·ª≠a RDEPENDS\nRDEPENDS_${PN} = \"correct-package-name\"\nüìã Copy\n7. L·ªói khi t·∫°o image\n7.1. L·ªói thi·∫øu b·ªô nh·ªõ\nTri·ªáu ch·ª©ng:\n\nERROR: No space left on rootfs\nüìã Copy\nNguy√™n nh√¢n: K√≠ch th∆∞·ªõc rootfs qu√° nh·ªè cho c√°c g√≥i ƒë∆∞·ª£c c√†i ƒë·∫∑t.\n\nGi·∫£i ph√°p:\n\n# TƒÉng k√≠ch th∆∞·ªõc rootfs trong local.conf\nIMAGE_ROOTFS_SIZE = \"8192\"  # K√≠ch th∆∞·ªõc t√≠nh b·∫±ng KB\n\n# Ho·∫∑c lo·∫°i b·ªè m·ªôt s·ªë g√≥i\nIMAGE_INSTALL_remove = \"large-package\"\nüìã Copy\n7.2. L·ªói xung ƒë·ªôt g√≥i\nTri·ªáu ch·ª©ng:\n\nERROR: Package X conflicts with package Y\nüìã Copy\nNguy√™n nh√¢n: Hai g√≥i kh√¥ng th·ªÉ c√†i ƒë·∫∑t c√πng nhau.\n\nGi·∫£i ph√°p:\n\n# Lo·∫°i b·ªè m·ªôt trong c√°c g√≥i xung ƒë·ªôt\nIMAGE_INSTALL_remove = \"conflicting-package\"\n\n# Ho·∫∑c ch·ªâ ƒë·ªãnh phi√™n b·∫£n kh√¥ng xung ƒë·ªôt\nPREFERRED_VERSION_package = \"non-conflicting-version\"\nüìã Copy\n7.3. L·ªói thi·∫øu g√≥i\nTri·ªáu ch·ª©ng:\n\nERROR: Required package X not found in any package feed\nüìã Copy\nNguy√™n nh√¢n: G√≥i y√™u c·∫ßu kh√¥ng c√≥ s·∫µn.\n\nGi·∫£i ph√°p:\n\n# Th√™m recipe cho g√≥i b·ªã thi·∫øu\n# Ho·∫∑c th√™m layer ch·ª©a g√≥i\nbitbake-layers add-layer /path/to/layer-with-package\n\n# Ki·ªÉm tra t√™n g√≥i ch√≠nh x√°c\nbitbake-layers show-recipes | grep package-name\nüìã Copy\n8. L·ªói SDK\n8.1. L·ªói x√¢y d·ª±ng SDK\nTri·ªáu ch·ª©ng:\n\nERROR: Function failed: populate_sdk\nüìã Copy\nNguy√™n nh√¢n: L·ªói khi t·∫°o SDK.\n\nGi·∫£i ph√°p:\n\n# Ki·ªÉm tra log chi ti·∫øt\nless tmp/work/*/temp/log.do_populate_sdk\n\n# Th√™m c√°c g√≥i c·∫ßn thi·∫øt v√†o SDK\nTOOLCHAIN_HOST_TASK += \"nativesdk-package\"\nTOOLCHAIN_TARGET_TASK += \"target-package\"\nüìã Copy\n8.2. L·ªói c√†i ƒë·∫∑t SDK\nTri·ªáu ch·ª©ng:\n\nError: Unable to create directory /opt/poky/...\nüìã Copy\nNguy√™n nh√¢n: Kh√¥ng c√≥ quy·ªÅn ghi v√†o th∆∞ m·ª•c c√†i ƒë·∫∑t.\n\nGi·∫£i ph√°p:\n\n# Ch·∫°y script c√†i ƒë·∫∑t v·ªõi sudo\nsudo ./poky-glibc-x86_64-core-image-minimal-toolchain-*.sh\n\n# Ho·∫∑c ch·ªâ ƒë·ªãnh th∆∞ m·ª•c c√†i ƒë·∫∑t kh√°c\n./poky-glibc-x86_64-core-image-minimal-toolchain-*.sh -d /path/with/write/permission\nüìã Copy\n8.3. L·ªói s·ª≠ d·ª•ng SDK\nTri·ªáu ch·ª©ng:\n\nError: SDK environment script not found\nüìã Copy\nNguy√™n nh√¢n: Script m√¥i tr∆∞·ªùng SDK kh√¥ng ƒë∆∞·ª£c t√¨m th·∫•y ho·∫∑c kh√¥ng ƒë∆∞·ª£c ch·∫°y.\n\nGi·∫£i ph√°p:\n\n# Source script m√¥i tr∆∞·ªùng\nsource /opt/poky/*/environment-setup-*\n\n# Ki·ªÉm tra bi·∫øn m√¥i tr∆∞·ªùng\necho $CC\nüìã Copy\n9. C√°c c√¥ng c·ª• g·ª° l·ªói\n9.1. Ki·ªÉm tra log build\n# Xem log c·ªßa task c·ª• th·ªÉ\nbitbake -e recipe | grep ^T=\nless tmp/work/*/recipe/*/temp/log.do_task\n\n# B·∫≠t ch·∫ø ƒë·ªô log chi ti·∫øt\nbitbake recipe -v\n\n# Xem log c·ªßa task g·∫ßn nh·∫•t th·∫•t b·∫°i\nbitbake recipe -c task -f -v\nüìã Copy\n9.2. Ki·ªÉm tra bi·∫øn m√¥i tr∆∞·ªùng\n# Xem t·∫•t c·∫£ c√°c bi·∫øn c·ªßa recipe\nbitbake -e recipe > recipe-env.txt\n\n# T√¨m bi·∫øn c·ª• th·ªÉ\nbitbake -e recipe | grep ^VARIABLE=\n\n# Ki·ªÉm tra gi√° tr·ªã bi·∫øn trong recipe\nbitbake -e recipe | grep ^S=\nüìã Copy\n9.3. Ch·∫°y task th·ªß c√¥ng\n# Ch·∫°y l·∫°i task c·ª• th·ªÉ\nbitbake recipe -c task -f\n\n# Ch·∫°y task v·ªõi shell t∆∞∆°ng t√°c\nbitbake recipe -c devshell\n\n# X√≥a tr·∫°ng th√°i task v√† ch·∫°y l·∫°i\nbitbake recipe -c cleansstate\nbitbake recipe\nüìã Copy\n9.4. Ki·ªÉm tra ph·ª• thu·ªôc\n# Xem c√¢y ph·ª• thu·ªôc\nbitbake -g recipe\ndot -Tpng -o deps.png task-depends.dot\n\n# Ki·ªÉm tra c√°c g√≥i cung c·∫•p ph·ª• thu·ªôc\nbitbake -s | grep dependency\n\n# Xem c√°c ph·ª• thu·ªôc c·ªßa recipe\nbitbake -e recipe | grep ^DEPENDS=\nüìã Copy\n10. K·∫øt lu·∫≠n\nYocto Project l√† m·ªôt h·ªá th·ªëng ph·ª©c t·∫°p v·ªõi nhi·ªÅu th√†nh ph·∫ßn t∆∞∆°ng t√°c, do ƒë√≥ vi·ªác g·∫∑p l·ªói l√† ƒëi·ªÅu kh√¥ng th·ªÉ tr√°nh kh·ªèi trong qu√° tr√¨nh ph√°t tri·ªÉn. Tuy nhi√™n, v·ªõi hi·ªÉu bi·∫øt v·ªÅ c√°c lo·∫°i l·ªói ph·ªï bi·∫øn v√† c√°ch kh·∫Øc ph·ª•c, b·∫°n c√≥ th·ªÉ gi·∫£i quy·∫øt ch√∫ng m·ªôt c√°ch hi·ªáu qu·∫£.\n\nM·ªôt s·ªë l·ªùi khuy√™n chung khi g·ª° l·ªói trong Yocto:\n\nƒê·ªçc log c·∫©n th·∫≠n: H·∫ßu h·∫øt c√°c l·ªói ƒë·ªÅu c√≥ th√¥ng tin chi ti·∫øt trong log. T·∫≠p trung v√†o d√≤ng cu·ªëi c√πng c·ªßa l·ªói v√† theo d√µi ng∆∞·ª£c l·∫°i ƒë·ªÉ t√¨m nguy√™n nh√¢n.\nT√¨m ki·∫øm trong c·ªông ƒë·ªìng: Nhi·ªÅu l·ªói ƒë√£ ƒë∆∞·ª£c b√°o c√°o v√† gi·∫£i quy·∫øt trong c·ªông ƒë·ªìng Yocto. T√¨m ki·∫øm tr√™n Yocto Project mailing list, Stack Overflow ho·∫∑c GitHub issues.\nPh√¢n chia v·∫•n ƒë·ªÅ: N·∫øu b·∫°n g·∫∑p nhi·ªÅu l·ªói c√πng l√∫c, h√£y gi·∫£i quy·∫øt t·ª´ng l·ªói m·ªôt. B·∫Øt ƒë·∫ßu v·ªõi l·ªói ƒë·∫ßu ti√™n xu·∫•t hi·ªán trong log.\nS·ª≠ d·ª•ng c√°c c√¥ng c·ª• g·ª° l·ªói: Yocto cung c·∫•p nhi·ªÅu c√¥ng c·ª• nh∆∞ bitbake -e, devshell v√† bitbake-layers ƒë·ªÉ gi√∫p b·∫°n hi·ªÉu v√† g·ª° l·ªói.\nGi·ªØ h·ªá th·ªëng s·∫°ch: Th∆∞·ªùng xuy√™n d·ªçn d·∫πp c√°c build c≈© b·∫±ng c√°ch s·ª≠ d·ª•ng bitbake -c cleansstate ƒë·ªÉ tr√°nh c√°c l·ªói do tr·∫°ng th√°i c≈©.\nV·ªõi ki·∫øn th·ª©c v·ªÅ c√°c l·ªói ph·ªï bi·∫øn v√† c√°ch kh·∫Øc ph·ª•c ƒë∆∞·ª£c tr√¨nh b√†y trong b√†i vi·∫øt n√†y, b·∫°n s·∫Ω t·ª± tin h∆°n khi ph√°t tri·ªÉn v·ªõi Yocto Project v√† c√≥ th·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ m·ªôt c√°ch hi·ªáu qu·∫£."}, {"id": "content/2-c-c-thu-t-ng-quan-tr-ng-trong-yocto.md", "title": "C√°c thu·∫≠t ng·ªØ c∆° b·∫£n trong Yocto (Raspberry Pi 4)", "body": "# C√°c thu·∫≠t ng·ªØ c∆° b·∫£n trong Yocto (Raspberry Pi 4)\n\nB√†i vi·∫øt n√†y ƒë·∫∑c bi·ªát ph√π h·ª£p v·ªõi nh·ªØng b·∫°n m·ªõi b·∫Øt ƒë·∫ßu ti·∫øp c·∫≠n Yocto v√† mu·ªën n·∫Øm r√µ c√°c thu·∫≠t ng·ªØ th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng, v·ªõi v√≠ d·ª• √°p d·ª•ng cho **Raspberry Pi 4 (64-bit)**.\n\n---\n\n## 1. Image\nImage l√† m·ªôt recipe ƒë·ªãnh nghƒ©a nh·ªØng th√†nh ph·∫ßn s·∫Ω c√≥ trong root file system (RFS). Yocto cung c·∫•p m·ªôt s·ªë image m·∫∑c ƒë·ªãnh trong Poky, ch·∫≥ng h·∫°n nh∆∞ `core-image-minimal`, ƒë√¢y l√† m·ªôt image t·ªëi thi·ªÉu ƒë·ªÉ h·ªá th·ªëng c√≥ th·ªÉ kh·ªüi ƒë·ªông.\n\nV√≠ d·ª•: `core-image-minimal.bb`  \n\n```bitbake\nSUMMARY = \"A small image just capable of allowing a device to boot.\"\nIMAGE_INSTALL = \"packagegroup-core-boot ${CORE_IMAGE_EXTRA_INSTALL}\"\nIMAGE_LINGUAS = \" \"\nLICENSE = \"MIT\"\ninherit core-image\nIMAGE_ROOTFS_SIZE ?= \"8192\"\nIMAGE_ROOTFS_EXTRA_SPACE_append = \"${@bb.utils.contains(\"DISTRO_FEATURES\", \"systemd\", \" + 4096\", \"\" ,d)}\"\n```\n\n- **IMAGE_INSTALL**: C√°c g√≥i c√†i v√†o RFS.  \n- **CORE_IMAGE_EXTRA_INSTALL**: Th√™m g√≥i t√πy bi·∫øn.  \n- **IMAGE_ROOTFS_SIZE**: K√≠ch th∆∞·ªõc rootfs.  \n- **inherit core-image**: K·∫ø th·ª´a class ƒë·ªãnh nghƒ©a image c∆° b·∫£n.  \n\n---\n\n## 2. Machine file\nMachine m√¥ t·∫£ ph·∫ßn c·ª©ng c·ª• th·ªÉ ƒë·ªÉ build image. V·ªõi Raspberry Pi 4, file c·∫•u h√¨nh n·∫±m trong `meta-raspberrypi/conf/machine/raspberrypi4-64.conf`.\n\nV√≠ d·ª• r√∫t g·ªçn:  \n\n```conf\n#@TYPE: Machine\n#@NAME: Raspberry Pi 4 Model B\n#@DESCRIPTION: Machine configuration for Raspberry Pi 4 64-bit\n\nPREFERRED_PROVIDER_virtual/kernel ?= \"linux-raspberrypi\"\nUBOOT_MACHINE = \"rpi_4_defconfig\"\nKERNEL_IMAGETYPE = \"Image\"\n\nSERIAL_CONSOLES ?= \"115200;ttyAMA0\"\n\nMACHINE_FEATURES += \"wifi bluetooth vc4graphics\"\n```\n\n- **UBOOT_MACHINE**: ch·ªâ ƒë·ªãnh c·∫•u h√¨nh U-Boot cho Pi 4.  \n- **KERNEL_IMAGETYPE**: d√πng `Image` (ARM64) thay v√¨ `bzImage`.  \n- **SERIAL_CONSOLES**: UART m·∫∑c ƒë·ªãnh qua `ttyAMA0`.  \n- **MACHINE_FEATURES**: c√≥ th√™m WiFi, Bluetooth, GPU VideoCore IV.  \n\n---\n\n## 3. Distro\nDistro l√† m·ªôt b·∫£n ph√¢n ph·ªëi ho√†n ch·ªânh. M·∫∑c ƒë·ªãnh Yocto d√πng `poky`, b·∫°n c√≥ th·ªÉ ki·ªÉm tra trong `conf/local.conf`:  \n\n```conf\nDISTRO ?= \"poky\"\n```\n\nFile c·∫•u h√¨nh distro `poky.conf` ƒë·ªãnh nghƒ©a:  \n\n- **DISTRO**: t√™n b·∫£n ph√¢n ph·ªëi.  \n- **DISTRO_FEATURES**: c√°c t√≠nh nƒÉng b·∫≠t s·∫µn (nh∆∞ opengl, wayland, vulkan).  \n- **PREFERRED_VERSION_linux-yocto**: kernel m·∫∑c ƒë·ªãnh, c√≥ th·ªÉ override b·∫±ng kernel c·ªßa Pi (`linux-raspberrypi`).  \n\n---\n\n## 4. Local.conf\n`local.conf` n·∫±m trong `build/conf/` d√πng ƒë·ªÉ t√πy ch·ªânh cho m√°y build:  \n\n- **MACHINE**:  \n  ```conf\n  MACHINE ?= \"raspberrypi4-64\"\n  ```\n- **IMAGE_FSTYPES**: ƒë·ªãnh d·∫°ng image, v√≠ d·ª• `.wic.bz2`.  \n- **BB_NUMBER_THREADS** v√† **PARALLEL_MAKE**: ƒëi·ªÅu ch·ªânh lu·ªìng CPU ƒë·ªÉ tƒÉng t·ªëc build.  \n- **TMPDIR**: th∆∞ m·ª•c ch·ª©a output build.  \n\n---\n\n## 5. K·∫øt lu·∫≠n\nTrong b√†i vi·∫øt n√†y, ch√∫ng ta ƒë√£ t√¨m hi·ªÉu c√°c thu·∫≠t ng·ªØ c∆° b·∫£n trong Yocto, √°p d·ª•ng cho **Raspberry Pi 4**. Vi·ªác hi·ªÉu r√µ Image, Machine, Distro v√† Local.conf s·∫Ω gi√∫p b·∫°n d·ªÖ d√†ng t√πy ch·ªânh v√† x√¢y d·ª±ng h·ªá ƒëi·ªÅu h√†nh nh√∫ng theo nhu c·∫ßu.  \n\n---\n"}, {"id": "content/3-ch-y-gi-l-p-image-b-ng-qemu.md", "title": "X√¢y d·ª±ng Image cho Raspberry Pi 4 v·ªõi Yocto Project", "body": "# X√¢y d·ª±ng Image cho Raspberry Pi 4 v·ªõi Yocto Project\n\n## 1. Y√™u c·∫ßu ph·∫ßn c·ª©ng v√† ph·∫ßn m·ªÅm\n\n### 1.1. Y√™u c·∫ßu ph·∫ßn c·ª©ng\nƒê·ªÉ qu√° tr√¨nh build m∆∞·ª£t m√†, n√™n chu·∫©n b·ªã:\n- **CPU**: T·ªëi thi·ªÉu 4 nh√¢n (quad-core) ho·∫∑c cao h∆°n\n- **RAM**: T·ªëi thi·ªÉu 8GB (khuy·∫øn ngh·ªã 16GB+)\n- **·ªî ƒëƒ©a**: Tr·ªëng t·ªëi thi·ªÉu 50GB (khuy·∫øn ngh·ªã 100GB+). **SSD** s·∫Ω nhanh h∆°n HDD\n- **Thi·∫øt b·ªã**: Raspberry Pi 4 (1/2/4/8GB), th·∫ª **microSD ‚â• 16GB**, ngu·ªìn t·ªët, c√°p HDMI/USB-serial (tu·ª≥ nhu c·∫ßu)\n\n### 1.2. Y√™u c·∫ßu ph·∫ßn m·ªÅm\n- **H·ªá ƒëi·ªÅu h√†nh host**: Ubuntu 20.04 LTS tr·ªü l√™n ho·∫∑c Debian 10+. (Fedora/CentOS d√πng ƒë∆∞·ª£c nh∆∞ng c√≥ th·ªÉ c·∫ßn c·∫•u h√¨nh th√™m)\n\n### 1.3. C·∫•u h√¨nh tham kh·∫£o\n- H·ªá ƒëi·ªÅu h√†nh: Ubuntu 22.04  \n- RAM: 8GB  \n- ·ªî c·ª©ng: 100GB SSD  \n- CPU: 4 nh√¢n, 2 lu·ªìng, 3.2GHz  \n\n---\n\n## 2. Chu·∫©n b·ªã m√¥i tr∆∞·ªùng\n\n### 2.1. C√†i ƒë·∫∑t c√°c c√¥ng c·ª• c·∫ßn thi·∫øt\n\n**Ubuntu / Debian**\n```bash\nsudo apt-get update\nsudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib \\\n  build-essential chrpath socat cpio python3 python3-pip python3-pexpect \\\n  xz-utils debianutils iputils-ping libsdl1.2-dev xterm vim zstd liblz4-tool\nFedora\n\nbash\nCopy\nEdit\nsudo dnf install gawk make wget tar bzip2 gzip python3 unzip perl patch \\\n  diffutils diffstat git cpp gcc gcc-c++ glibc-devel texinfo chrpath \\\n  ccache perl-Data-Dumper perl-Text-ParseWords perl-Thread-Queue perl-bignum socat \\\n  python3-pexpect findutils which file cpio python3-pip xz SDL-devel xterm zstd lz4\n3. T·∫£i m√£ ngu·ªìn Yocto Project\n3.1. Chu·∫©n b·ªã th∆∞ m·ª•c & clone\nbash\nCopy\nEdit\nmkdir -p ~/yocto\ncd ~/yocto\n\n# Poky (ch·ªçn nh√°nh cho ph√π h·ª£p, v√≠ d·ª• dunfell ƒë·ªÉ ƒë·ªìng b·ªô v·ªõi h∆∞·ªõng d·∫´n)\ngit clone -b dunfell git://git.yoctoproject.org/poky\ncd poky\n\n# Layer cho Raspberry Pi + OE\ngit clone -b dunfell git://git.yoctoproject.org/meta-raspberrypi\ngit clone -b dunfell git://git.openembedded.org/meta-openembedded\n3.2. C·∫•u tr√∫c ch√≠nh trong Poky (nh·∫Øc l·∫°i nhanh)\nbitbake/ ‚Äì c√¥ng c·ª• BitBake\n\nmeta/ ‚Äì layer l√µi (OE-Core)\n\nmeta-poky/ ‚Äì distro tham chi·∫øu Poky\n\nmeta-yocto-bsp/ ‚Äì BSP m·∫´u\n\noe-init-build-env ‚Äì script thi·∫øt l·∫≠p m√¥i tr∆∞·ªùng build\n\n4. X√¢y d·ª±ng image cho Raspberry Pi 4\nRaspberry Pi 4 l√† ARM64, d√πng MACHINE: raspberrypi4-64.\n\n4.1. Chuy·ªÉn nh√°nh (n·∫øu c·∫ßn)\nbash\nCopy\nEdit\ncd ~/yocto/poky\ngit checkout dunfell\n4.2. Kh·ªüi t·∫°o m√¥i tr∆∞·ªùng build\nbash\nCopy\nEdit\nsource oe-init-build-env\nSau l·ªánh n√†y s·∫Ω c√≥ th∆∞ m·ª•c build/ ch·ª©a c·∫•u h√¨nh.\n\n4.3. T√πy ch·ªânh file c·∫•u h√¨nh\n4.3.1. conf/local.conf\nM·ªü poky/build/conf/local.conf v√† c·∫≠p nh·∫≠t:\n\nconf\nCopy\nEdit\n# Ti·∫øt ki·ªám dung l∆∞·ª£ng (x√≥a work sau build xong)\nINHERIT += \"rm_work\"\n\n# ƒê·ªãnh d·∫°ng g√≥i (m·∫∑c ƒë·ªãnh l√† RPM, c√≥ th·ªÉ gi·ªØ nguy√™n)\nPACKAGE_CLASSES ?= \"package_rpm\"\n\n# Quan tr·ªçng: target board\nMACHINE ?= \"raspberrypi4-64\"\n\n# M·ªôt s·ªë ti·ªán √≠ch khuy·∫øn ngh·ªã (tu·ª≥ ch·ªçn)\nEXTRA_IMAGE_FEATURES ?= \"debug-tweaks\"\n\n# (Tu·ª≥ ch·ªçn) Th√™m Wi-Fi/Bluetooth tools & firmware\nIMAGE_INSTALL:append = \" linux-firmware-brcm43455 pi-bluetooth iw wpa-supplicant bluez5\"\n4.3.2. conf/bblayers.conf\nTh√™m meta-raspberrypi v√† meta-openembedded/meta-oe:\n\nconf\nCopy\nEdit\nBBLAYERS ?= \" \\\n  /home/<user>/yocto/poky/meta \\\n  /home/<user>/yocto/poky/meta-poky \\\n  /home/<user>/yocto/poky/meta-yocto-bsp \\\n  /home/<user>/yocto/poky/meta-raspberrypi \\\n  /home/<user>/yocto/poky/meta-openembedded/meta-oe \\\n\"\nThay <user> b·∫±ng t√™n ng∆∞·ªùi d√πng/ƒë∆∞·ªùng d·∫´n th·ª±c t·∫ø.\n\n4.4. Ti·∫øn h√†nh build\nB·∫°n c√≥ th·ªÉ build image t·ªëi thi·ªÉu ho·∫∑c c√≥ giao di·ªán:\n\nbash\nCopy\nEdit\n# Image console t·ªëi thi·ªÉu\nbitbake core-image-minimal\n\n# (Tu·ª≥ ch·ªçn) Image c√≥ giao di·ªán Sato\n# bitbake core-image-sato\n4.5. V·ªã tr√≠ image ƒë·∫ßu ra\nSau khi build xong, image n·∫±m t·∫°i:\n\nswift\nCopy\nEdit\nbuild/tmp/deploy/images/raspberrypi4-64/\nTh∆∞·ªùng c√≥ c√°c ƒë·ªãnh d·∫°ng nh∆∞ .wic.bz2, .rpi-sdimg, v.v.\n\n4.6. Ghi image v√†o th·∫ª microSD\nX√°c ƒë·ªãnh thi·∫øt b·ªã th·∫ª nh·ªõ:\n\nbash\nCopy\nEdit\nlsblk\nGi·∫£i n√©n & ghi image (v√≠ d·ª• d√πng .wic.bz2):\n\nbash\nCopy\nEdit\ncd ~/yocto/poky/build/tmp/deploy/images/raspberrypi4-64/\n\n# Ch·ªçn ƒë√∫ng file .wic.bz2 sinh ra\ncp core-image-minimal-raspberrypi4-64-*.wic.bz2 ./temp.wic.bz2\nbzip2 -d temp.wic.bz2\n\n# C·∫¢NH B√ÅO: thay /dev/sdX b·∫±ng thi·∫øt b·ªã th·∫ª nh·ªõ ch√≠nh x√°c!\nsudo dd if=temp.wic of=/dev/sdX bs=4M status=progress conv=fsync\nsync\n(Tu·ª≥ ch·ªçn) N·∫øu c√≥ .bmap, d√πng bmaptool s·∫Ω nhanh h∆°n:\n\nbash\nCopy\nEdit\nsudo apt-get install bmap-tools\nsudo bmaptool copy core-image-minimal-raspberrypi4-64-*.wic.bz2 /dev/sdX\n4.7. Kh·ªüi ƒë·ªông Raspberry Pi 4\nC·∫Øm th·∫ª microSD v√†o Pi 4, c·∫•p ngu·ªìn.\n\nK·∫øt n·ªëi HDMI ƒë·ªÉ theo d√µi boot (n·∫øu image ƒë·ªì ho·∫°) ho·∫∑c UART/SSH (n·∫øu image console).\n\nV·ªõi debug-tweaks, t√†i kho·∫£n root th∆∞·ªùng kh√¥ng m·∫≠t kh·∫©u khi truy c·∫≠p terminal tr·ª±c ti·∫øp.\n\nC·∫•u h√¨nh Wi-Fi (n·∫øu c·∫ßn):\n\nbash\nCopy\nEdit\n# v√≠ d·ª• ƒë∆°n gi·∫£n v·ªõi wpa_cli / wpa_supplicant\n# ho·∫∑c t·∫°o /etc/wpa_supplicant/wpa_supplicant.conf\n5. K·∫øt lu·∫≠n\nB·∫°n ƒë√£:\n\nChuy·ªÉn t·ª´ m√¥i tr∆∞·ªùng QEMU sang Raspberry Pi 4 (raspberrypi4-64)\n\nTh√™m meta-raspberrypi, c·∫•u h√¨nh local.conf & bblayers.conf ph√π h·ª£p\n\nBuild image v√† flash v√†o th·∫ª microSD ƒë·ªÉ ch·∫°y tr√™n ph·∫ßn c·ª©ng th·ª±c\n\nYocto cho ph√©p tu·ª≥ bi·∫øn r·∫•t cao. T·ª´ ƒë√¢y, b·∫°n c√≥ th·ªÉ th√™m package, firmware, UI (Sato/Wayland), ho·∫∑c t√≠ch h·ª£p CI/CD theo nhu c·∫ßu."}, {"id": "content/4-t-o-layer-n-gi-n-v-th-m-ch-ng-tr-nh-helloworld.md", "title": "X√¢y d·ª±ng Image cho Raspberry Pi 4 v·ªõi Yocto Project", "body": "# X√¢y d·ª±ng Image cho Raspberry Pi 4 v·ªõi Yocto Project\n\n## 1. Y√™u c·∫ßu ph·∫ßn c·ª©ng v√† ph·∫ßn m·ªÅm\n\n### 1.1. Y√™u c·∫ßu ph·∫ßn c·ª©ng\nƒê·ªÉ qu√° tr√¨nh build m∆∞·ª£t m√†, n√™n chu·∫©n b·ªã:\n- **CPU**: T·ªëi thi·ªÉu 4 nh√¢n (quad-core) ho·∫∑c cao h∆°n\n- **RAM**: T·ªëi thi·ªÉu 8GB (khuy·∫øn ngh·ªã 16GB+)\n- **·ªî ƒëƒ©a**: Tr·ªëng t·ªëi thi·ªÉu 50GB (khuy·∫øn ngh·ªã 100GB+). **SSD** s·∫Ω nhanh h∆°n HDD\n- **Thi·∫øt b·ªã**: Raspberry Pi 4 (1/2/4/8GB), th·∫ª **microSD ‚â• 16GB**, ngu·ªìn t·ªët, c√°p HDMI/USB-serial (tu·ª≥ nhu c·∫ßu)\n\n### 1.2. Y√™u c·∫ßu ph·∫ßn m·ªÅm\n- **H·ªá ƒëi·ªÅu h√†nh host**: Ubuntu 20.04 LTS tr·ªü l√™n ho·∫∑c Debian 10+. (Fedora/CentOS d√πng ƒë∆∞·ª£c nh∆∞ng c√≥ th·ªÉ c·∫ßn c·∫•u h√¨nh th√™m)\n\n### 1.3. C·∫•u h√¨nh tham kh·∫£o\n- H·ªá ƒëi·ªÅu h√†nh: Ubuntu 22.04  \n- RAM: 8GB  \n- ·ªî c·ª©ng: 100GB SSD  \n- CPU: 4 nh√¢n, 2 lu·ªìng, 3.2GHz  \n\n---\n\n## 2. Chu·∫©n b·ªã m√¥i tr∆∞·ªùng\n\n### 2.1. C√†i ƒë·∫∑t c√°c c√¥ng c·ª• c·∫ßn thi·∫øt\n\n**Ubuntu / Debian**\n```bash\nsudo apt-get update\nsudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib   build-essential chrpath socat cpio python3 python3-pip python3-pexpect   xz-utils debianutils iputils-ping libsdl1.2-dev xterm vim zstd liblz4-tool\n```\n\n**Fedora**\n```bash\nsudo dnf install gawk make wget tar bzip2 gzip python3 unzip perl patch   diffutils diffstat git cpp gcc gcc-c++ glibc-devel texinfo chrpath   ccache perl-Data-Dumper perl-Text-ParseWords perl-Thread-Queue perl-bignum socat   python3-pexpect findutils which file cpio python3-pip xz SDL-devel xterm zstd lz4\n```\n\n---\n\n## 3. T·∫£i m√£ ngu·ªìn Yocto Project\n\n### 3.1. Chu·∫©n b·ªã th∆∞ m·ª•c & clone\n```bash\nmkdir -p ~/yocto\ncd ~/yocto\n\n# Poky (ch·ªçn nh√°nh cho ph√π h·ª£p, v√≠ d·ª• dunfell ƒë·ªÉ ƒë·ªìng b·ªô v·ªõi h∆∞·ªõng d·∫´n)\ngit clone -b dunfell git://git.yoctoproject.org/poky\ncd poky\n\n# Layer cho Raspberry Pi + OE\ngit clone -b dunfell git://git.yoctoproject.org/meta-raspberrypi\ngit clone -b dunfell git://git.openembedded.org/meta-openembedded\n```\n\n### 3.2. C·∫•u tr√∫c ch√≠nh trong Poky (nh·∫Øc l·∫°i nhanh)\n- **bitbake/** ‚Äì c√¥ng c·ª• BitBake\n- **meta/** ‚Äì layer l√µi (OE-Core)\n- **meta-poky/** ‚Äì distro tham chi·∫øu Poky\n- **meta-yocto-bsp/** ‚Äì BSP m·∫´u\n- **oe-init-build-env** ‚Äì script thi·∫øt l·∫≠p m√¥i tr∆∞·ªùng build\n\n---\n\n## 4. X√¢y d·ª±ng image cho Raspberry Pi 4\n\n> Raspberry Pi 4 l√† **ARM64**, d√πng MACHINE: `raspberrypi4-64`.\n\n### 4.1. Chuy·ªÉn nh√°nh (n·∫øu c·∫ßn)\n```bash\ncd ~/yocto/poky\ngit checkout dunfell\n```\n\n### 4.2. Kh·ªüi t·∫°o m√¥i tr∆∞·ªùng build\n```bash\nsource oe-init-build-env\n```\nSau l·ªánh n√†y s·∫Ω c√≥ th∆∞ m·ª•c `build/` ch·ª©a c·∫•u h√¨nh.\n\n### 4.3. T√πy ch·ªânh file c·∫•u h√¨nh\n\n#### 4.3.1. `conf/local.conf`\nM·ªü `poky/build/conf/local.conf` v√† c·∫≠p nh·∫≠t:\n```conf\n# Ti·∫øt ki·ªám dung l∆∞·ª£ng (x√≥a work sau build xong)\nINHERIT += \"rm_work\"\n\n# ƒê·ªãnh d·∫°ng g√≥i (m·∫∑c ƒë·ªãnh l√† RPM, c√≥ th·ªÉ gi·ªØ nguy√™n)\nPACKAGE_CLASSES ?= \"package_rpm\"\n\n# Quan tr·ªçng: target board\nMACHINE ?= \"raspberrypi4-64\"\n\n# M·ªôt s·ªë ti·ªán √≠ch khuy·∫øn ngh·ªã (tu·ª≥ ch·ªçn)\nEXTRA_IMAGE_FEATURES ?= \"debug-tweaks\"\n\n# (Tu·ª≥ ch·ªçn) Th√™m Wi-Fi/Bluetooth tools & firmware\nIMAGE_INSTALL:append = \" linux-firmware-brcm43455 pi-bluetooth iw wpa-supplicant bluez5\"\n```\n\n#### 4.3.2. `conf/bblayers.conf`\nTh√™m `meta-raspberrypi` v√† `meta-openembedded/meta-oe`:\n```conf\nBBLAYERS ?= \"   /home/<user>/yocto/poky/meta   /home/<user>/yocto/poky/meta-poky   /home/<user>/yocto/poky/meta-yocto-bsp   /home/<user>/yocto/poky/meta-raspberrypi   /home/<user>/yocto/poky/meta-openembedded/meta-oe \"\n```\n> Thay `<user>` b·∫±ng t√™n ng∆∞·ªùi d√πng/ƒë∆∞·ªùng d·∫´n th·ª±c t·∫ø.\n\n### 4.4. Ti·∫øn h√†nh build\nB·∫°n c√≥ th·ªÉ build image t·ªëi thi·ªÉu ho·∫∑c c√≥ giao di·ªán:\n```bash\n# Image console t·ªëi thi·ªÉu\nbitbake core-image-minimal\n\n# (Tu·ª≥ ch·ªçn) Image c√≥ giao di·ªán Sato\n# bitbake core-image-sato\n```\n\n### 4.5. V·ªã tr√≠ image ƒë·∫ßu ra\nSau khi build xong, image n·∫±m t·∫°i:\n```\nbuild/tmp/deploy/images/raspberrypi4-64/\n```\nTh∆∞·ªùng c√≥ c√°c ƒë·ªãnh d·∫°ng nh∆∞ `.wic.bz2`, `.rpi-sdimg`, v.v.\n\n### 4.6. Ghi image v√†o th·∫ª microSD\n\n**X√°c ƒë·ªãnh thi·∫øt b·ªã th·∫ª nh·ªõ**:\n```bash\nlsblk\n```\n\n**Gi·∫£i n√©n & ghi image** (v√≠ d·ª• d√πng `.wic.bz2`):\n```bash\ncd ~/yocto/poky/build/tmp/deploy/images/raspberrypi4-64/\n\n# Ch·ªçn ƒë√∫ng file .wic.bz2 sinh ra\ncp core-image-minimal-raspberrypi4-64-*.wic.bz2 ./temp.wic.bz2\nbzip2 -d temp.wic.bz2\n\n# C·∫¢NH B√ÅO: thay /dev/sdX b·∫±ng thi·∫øt b·ªã th·∫ª nh·ªõ ch√≠nh x√°c!\nsudo dd if=temp.wic of=/dev/sdX bs=4M status=progress conv=fsync\nsync\n```\n> (Tu·ª≥ ch·ªçn) N·∫øu c√≥ `.bmap`, d√πng `bmaptool` s·∫Ω nhanh h∆°n:\n> ```bash\n> sudo apt-get install bmap-tools\n> sudo bmaptool copy core-image-minimal-raspberrypi4-64-*.wic.bz2 /dev/sdX\n> ```\n\n### 4.7. Kh·ªüi ƒë·ªông Raspberry Pi 4\n- C·∫Øm th·∫ª microSD v√†o Pi 4, c·∫•p ngu·ªìn.  \n- K·∫øt n·ªëi **HDMI** ƒë·ªÉ theo d√µi boot (n·∫øu image ƒë·ªì ho·∫°) ho·∫∑c **UART**/SSH (n·∫øu image console).  \n- V·ªõi `debug-tweaks`, t√†i kho·∫£n `root` th∆∞·ªùng **kh√¥ng m·∫≠t kh·∫©u** khi truy c·∫≠p terminal tr·ª±c ti·∫øp.  \n- C·∫•u h√¨nh Wi-Fi (n·∫øu c·∫ßn):\n  ```bash\n  # v√≠ d·ª• ƒë∆°n gi·∫£n v·ªõi wpa_cli / wpa_supplicant\n  # ho·∫∑c t·∫°o /etc/wpa_supplicant/wpa_supplicant.conf\n  ```\n\n## Ph·ª• l·ª•c ‚Äî C·∫•u h√¨nh Wi-Fi (wpa_supplicant.conf)\n\n> Y√™u c·∫ßu: trong `local.conf` ƒë√£ c√≥ `wpa-supplicant` (v√≠ d·ª• `IMAGE_INSTALL:append = \" wpa-supplicant\"` ho·∫∑c theo m·∫´u ·ªü tr√™n).\n\n**T·∫°o file tr√™n target**: `/etc/wpa_supplicant/wpa_supplicant.conf`\n```conf\nctrl_interface=/var/run/wpa_supplicant\nupdate_config=1\ncountry=VN\n\nnetwork={\n    ssid=\"Ten_WiFi_cua_ban\"\n    psk=\"Mat_khau_WiFi\"\n    key_mgmt=WPA-PSK\n    priority=10\n}\n---\n\n## 5. K·∫øt lu·∫≠n\nB·∫°n ƒë√£:\n- Chuy·ªÉn t·ª´ m√¥i tr∆∞·ªùng QEMU sang **Raspberry Pi 4 (raspberrypi4-64)**  \n- Th√™m `meta-raspberrypi`, c·∫•u h√¨nh `local.conf` & `bblayers.conf` ph√π h·ª£p  \n- Build image v√† flash v√†o th·∫ª microSD ƒë·ªÉ ch·∫°y tr√™n ph·∫ßn c·ª©ng th·ª±c\n\nYocto cho ph√©p tu·ª≥ bi·∫øn r·∫•t cao. T·ª´ ƒë√¢y, b·∫°n c√≥ th·ªÉ th√™m package, firmware, UI (Sato/Wayland), ho·∫∑c t√≠ch h·ª£p CI/CD theo nhu c·∫ßu.\n"}, {"id": "content/5-t-m-hi-u-v-devtool-trong-yocto.md", "title": "Devtool trong Yocto: T·∫°o, ch·ªânh s·ª≠a v√† ki·ªÉm th·ª≠ recipe nhanh", "body": "# Devtool trong Yocto: T·∫°o, ch·ªânh s·ª≠a v√† ki·ªÉm th·ª≠ recipe nhanh\n\nTrong c√°c b√†i vi·∫øt tr∆∞·ªõc, ch√∫ng ta ƒë√£ c√πng t√¨m hi·ªÉu c√°ch t·∫°o m·ªôt **layer** ƒë∆°n gi·∫£n tr√™n Yocto v√† ch·∫°y gi·∫£ l·∫≠p tr√™n **QEMU**. Ti·∫øp n·ªëi chu·ªói b√†i vi·∫øt v·ªÅ **Yocto Project**, h√¥m nay ch√∫ng ta s·∫Ω kh√°m ph√° **Devtool** ‚Äì m·ªôt c√¥ng c·ª• h·ªó tr·ª£ m·∫°nh m·∫Ω gi√∫p c√°c nh√† ph√°t tri·ªÉn d·ªÖ d√†ng **t·∫°o**, **ch·ªânh s·ª≠a** v√† **ki·ªÉm th·ª≠** c√°c recipe trong Yocto.\n\nDevtool ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ **ƒë∆°n gi·∫£n h√≥a quy tr√¨nh** l√†m vi·ªác v·ªõi Yocto. Thay v√¨ thao t√°c th·ªß c√¥ng, Devtool cho ph√©p nhanh ch√≥ng t·∫°o, s·ª≠a v√† c·∫≠p nh·∫≠t recipe; ƒë·ªìng th·ªùi build & ki·ªÉm th·ª≠ g√≥i ph·∫ßn m·ªÅm tr∆∞·ªõc khi t√≠ch h·ª£p v√†o image cu·ªëi c√πng.\n\n---\n\n## 1. T·ªïng quan v·ªÅ Devtool\n\nDevtool d√πng ƒë·ªÉ:\n\n- T·∫°o m·ªõi, ch·ªânh s·ª≠a v√† c·∫≠p nh·∫≠t **recipe**  \n- **Build** v√† ki·ªÉm th·ª≠ **package**  \n- T√≠ch h·ª£p thay ƒë·ªïi v√†o **image** nhanh ch√≥ng\n\nThi·∫øt l·∫≠p m√¥i tr∆∞·ªùng tr∆∞·ªõc khi d√πng:\n\n```bash\n~/yocto/poky$ source oe-init-build-env\n```\n\nXem c√°c subcommand c√≥ s·∫µn:\n\n```bash\n~/yocto/poky/build$ devtool -h\n```\n\nM·ªôt s·ªë subcommand ph·ªï bi·∫øn:\n- `add` ‚Äì T·∫°o recipe m·ªõi\n- `modify` ‚Äì Ch·ªânh s·ª≠a source/recipe hi·ªán c√≥ (ƒë∆∞a v·ªÅ workspace)\n- `build` ‚Äì Build recipe ho·∫∑c image\n- `deploy-target` ‚Äì Tri·ªÉn khai nhanh g√≥i l√™n target qua SSH\n- `finish` ‚Äì Ho√†n t·∫•t, ƒë∆∞a recipe t·ª´ workspace v√†o layer\n- `reset` ‚Äì H·ªßy thay ƒë·ªïi trong workspace\n- `upgrade` ‚Äì N√¢ng c·∫•p recipe\n- `update-recipe` ‚Äì C·∫≠p nh·∫≠t recipe theo thay ƒë·ªïi trong source\n\n---\n\n## 2. C√°c l·ªánh ph·ªï bi·∫øn c·ªßa Devtool\n\n### 2.1. `devtool add`\n\nT·∫°o recipe m·ªõi t·ª´ source c√≥ s·∫µn (local ho·∫∑c remote). Sau khi ch·∫°y, Devtool t·∫°o **workspace** ch·ª©a source v√† recipe.\n\n**V√≠ d·ª•**: t·∫°o recipe t·ª´ GitHub\n\n```bash\n~/yocto/poky/build$ devtool add hello-devtool https://github.com/thanhdeptrai097/Yocto-For-Dummies.git --srcbranch custom-devtool\n```\n\nC·∫•u tr√∫c workspace r√∫t g·ªçn:\n\n```\nworkspace/\n‚îú‚îÄ‚îÄ appends     # L∆∞u c√°c thay ƒë·ªïi khi modify/upgrade\n‚îú‚îÄ‚îÄ conf        # L∆∞u c√°c file c·∫•u h√¨nh\n‚îú‚îÄ‚îÄ README\n‚îú‚îÄ‚îÄ recipes     # L∆∞u c√°c recipe m·ªõi ƒë∆∞·ª£c t·∫°o\n‚îî‚îÄ‚îÄ sources     # L∆∞u source code\n```\n\nƒê·ªçc source v·ª´a fetch:\n\n```bash\n~/yocto/poky/build$ cat workspace/sources/hello-devtool/hello-devtool.c\n```\n\n```c\n#include <stdio.h>\n\nint main()\n{\n    printf(\"thanhdeptrai: hello devtool!\\n\");\n    return 0;\n}\n```\n\nRecipe t·ª± sinh `hello-devtool_git.bb` (r√∫t g·ªçn):\n\n```bitbake\n# Recipe created by recipetool\n# (c·∫ßn ch·ªânh s·ª≠a LICENSE/LIC_FILES_CHKSUM cho ph√π h·ª£p)\nLICENSE = \"CLOSED\"\nLIC_FILES_CHKSUM = \"\"\n\nSRC_URI = \"git://github.com/thanhdeptrai097/Yocto-For-Dummies.git;protocol=https;branch=custom-devtool\"\n\n# Modify these as desired\nPV = \"1.0+git${SRCPV}\"\nSRCREV = \"9684263baeb96af50c937da46a63065c42703963\"\n\nS = \"${WORKDIR}/git\"\n\n# NOTE: no Makefile found, unable to determine what needs to be done\ndo_configure () { : }\ndo_compile () { : }\ndo_install () { : }\n```\n\n---\n\n### 2.2. `devtool build`\n\nBuild recipe ƒë·ªÉ ki·ªÉm th·ª≠ nhanh package.\n\nCh·ªânh `hello-devtool_git.bb` t·ªëi thi·ªÉu ƒë·ªÉ bi√™n d·ªãch & c√†i:\n\n```bitbake\nLICENSE = \"CLOSED\"\nLIC_FILES_CHKSUM = \"\"\n\nSRC_URI = \"git://github.com/thanhdeptrai097/Yocto-For-Dummies.git;protocol=https;branch=custom-devtool\"\n\nPV = \"1.0+git${SRCPV}\"\nSRCREV = \"9684263baeb96af50c937da46a63065c42703963\"\n\nS = \"${WORKDIR}/git\"\n\ndo_compile () {\n    ${CC} ${S}/hello-devtool.c ${LDFLAGS} -o ${S}/hello-devtool\n}\n\ndo_install () {\n    install -d ${D}${bindir}\n    install -m 0755 ${S}/hello-devtool ${D}${bindir}\n}\n```\n\nBuild th·ª≠:\n\n```bash\n~/yocto/poky/build$ devtool build hello-devtool\n```\n\nV√≠ d·ª• k·∫øt qu·∫£ th√†nh c√¥ng:\n\n```\nSstate summary: Wanted 0 Found 0 Missed 0 Current 124 (0% match, 100% complete)\nNOTE: Executing Tasks\nNOTE: hello-devtool: compiling from external source tree ...\nNOTE: Tasks Summary: Attempted 531 tasks ... all succeeded.\n```\n\nTh√™m v√†o image ƒë·ªÉ test tr√™n target:\n\n```conf\n# build/conf/local.conf\nIMAGE_INSTALL_append = \" hello-devtool\"\n```\n\nBuild & ch·∫°y QEMU:\n\n```bash\nbitbake core-image-minimal\nrunqemu qemux86-64 nographic\n```\n\nKi·ªÉm tra tr√™n target:\n\n```bash\nroot@arm:~# /usr/bin/hello-devtool\nthanhdeptrai: hello devtool!\n```\n\n---\n\n### 2.3. `devtool deploy-target`\n\nTri·ªÉn khai nhanh recipe ƒë√£ build l√™n target qua **SSH** (kh√¥ng c·∫ßn rebuild image).\n\n**Chu·∫©n b·ªã**: image c√≥ SSH server (dropbear/openssh). V√≠ d·ª•:\n\n```conf\n# build/conf/local.conf\nIMAGE_INSTALL_append = \" openssh\"\n# ho·∫∑c\n# EXTRA_IMAGE_FEATURES += \"ssh-server-openssh\"\n```\n\nKh·ªüi ch·∫°y image r·ªìi deploy:\n\n```bash\n# QEMU v√≠ d·ª•\nrunqemu qemux86-64 nographic\n\n# T·ª´ host (IP v√≠ d·ª• 192.168.7.2)\n~/yocto/poky/build$ devtool deploy-target hello-devtool root@192.168.7.2\n```\n\nCh·∫°y th·ª≠ tr√™n target:\n\n```bash\nroot@arm:~# /usr/bin/hello-devtool\nthanhdeptrai: hello devtool!\n```\n\n---\n\n### 2.4. `devtool finish`\n\nKhi ƒë√£ ·ªïn, chuy·ªÉn recipe t·ª´ workspace v√†o m·ªôt layer c·ªßa b·∫°n:\n\n```bash\n~/yocto/poky/build$ devtool finish -f hello-devtool ../meta-thanhdeptrai/recipes-apps/\n```\n\nTr∆∞·ªõc khi th√™m:\n\n```\nmeta-thanhdeptrai/recipes-apps\n‚îî‚îÄ‚îÄ hello-world\n    ‚îú‚îÄ‚îÄ files\n    ‚îÇ   ‚îî‚îÄ‚îÄ hello-world.c\n    ‚îî‚îÄ‚îÄ hello-world.bb\n```\n\nSau khi th√™m:\n\n```\nmeta-thanhdeptrai/recipes-apps\n‚îú‚îÄ‚îÄ hello-devtool\n‚îÇ   ‚îî‚îÄ‚îÄ hello-devtool_git.bb\n‚îî‚îÄ‚îÄ hello-world\n    ‚îú‚îÄ‚îÄ files\n    ‚îÇ   ‚îî‚îÄ‚îÄ hello-world.c\n    ‚îî‚îÄ‚îÄ hello-world.bb\n```\n\n---\n\n### 2.5. `devtool modify`\n\nƒê∆∞a source/recipe hi·ªán c√≥ v√†o workspace ƒë·ªÉ s·ª≠a:\n\n```bash\n~/yocto/poky/build$ devtool modify hello-devtool\n```\n\nS·ª≠a source, v√≠ d·ª•:\n\n```c\nint main()\n{\n    printf(\"thanhdeptrai: hello devtool!\\n\");\n    printf(\"This line edit in devtool modify.\\n\");\n    return 0;\n}\n```\n\nBuild l·∫°i & ki·ªÉm th·ª≠ nh∆∞ tr√™n.\n\n---\n\n### 2.6. `devtool reset`\n\nH·ªßy b·ªè m·ªçi thay ƒë·ªïi trong workspace cho recipe:\n\n```bash\ndevtool reset hello-devtool\n```\n\n---\n\n### 2.7. `devtool update-recipe`\n\nKhi source ƒë√£ thay ƒë·ªïi (ƒë√£ commit), c·∫≠p nh·∫≠t l·∫°i recipe.\n\nS·ª≠a code:\n\n```c\nint main()\n{\n    printf(\"thanhdeptrai: hello devtool!\\n\");\n    printf(\"This line edit in devtool modify.\\n\");\n    printf(\"This line is changed in devtool update-recipe\\n\");\n    return 0;\n}\n```\n\nCommit & c·∫≠p nh·∫≠t:\n\n```bash\n~/yocto/poky/build/workspace/sources/hello-devtool$ git add hello-devtool.c\n~/yocto/poky/build/workspace/sources/hello-devtool$ git commit -m \"Demo devtool update-recipe\"\n~/yocto/poky/build$ devtool update-recipe hello-devtool\n```\n\nKi·ªÉm tra recipe trong layer:\n\n```\nmeta-thanhdeptrai/recipes-apps/hello-devtool\n‚îú‚îÄ‚îÄ hello-devtool\n‚îÇ   ‚îî‚îÄ‚îÄ 0001-Demo-devtool-update-recipe.patch\n‚îî‚îÄ‚îÄ hello-devtool_git.bb\n```\n\n> File patch ch·ª©a chi ti·∫øt c√°c thay ƒë·ªïi ƒë√£ ghi nh·∫≠n.\n\n---\n\n## 3. K·∫øt lu·∫≠n\n\n**Devtool** l√† c√¥ng c·ª• m·∫°nh m·∫Ω v√† linh ho·∫°t gi√∫p:\n- T·∫°o m·ªõi/ch·ªânh s·ª≠a recipe nhanh ch√≥ng\n- Build & test g√≥i tr∆∞·ªõc khi bake v√†o image\n- Deploy nhanh l√™n target qua SSH\n- D·ªÖ d√†ng ‚Äúfinish‚Äù ƒë·ªÉ ƒë∆∞a recipe v√†o layer\n\nT·ª´ ƒë√¢y, b·∫°n c√≥ th·ªÉ k·∫øt h·ª£p Devtool v·ªõi **CI/CD**, chuy·ªÉn sang ph·∫ßn c·ª©ng th·ª±c (vd. Raspberry Pi 4 v·ªõi `MACHINE = \"raspberrypi4-64\"` + `meta-raspberrypi`), ho·∫∑c duy tr√¨ v√≤ng l·∫∑p ph√°t tri·ªÉn r·∫•t ng·∫Øn nh·ªù `devtool deploy-target`.\n"}, {"id": "content/6-package-dependencies-v-splitting-trong-yocto.md", "title": "Package Dependencies v√† Package Splitting trong Yocto", "body": "# Package Dependencies v√† Package Splitting trong Yocto\n\nTrong b√†i vi·∫øt n√†y, ch√∫ng ta s·∫Ω c√πng kh√°m ph√° hai kh√°i ni·ªám quan tr·ªçng trong **Yocto**:  \n**Package Dependencies** (ph·ª• thu·ªôc c·ªßa g√≥i) v√† **Package Splitting** (ph√¢n chia g√≥i).  \nƒê√¢y l√† c√°c kh√°i ni·ªám c·ªët l√µi gi√∫p t·ªëi ∆∞u ho√° hi·ªáu su·∫•t v√† tƒÉng t√≠nh linh ho·∫°t khi x√¢y d·ª±ng h·ªá th·ªëng nh√∫ng ho·∫∑c ph√¢n ph·ªëi Linux.\n\nKhi l√†m vi·ªác v·ªõi Yocto, vi·ªác qu·∫£n l√Ω ph·ª• thu·ªôc g√≥i v√† chia g√≥i ƒë√≥ng vai tr√≤ thi·∫øt y·∫øu trong vi·ªác **gi·∫£m dung l∆∞·ª£ng**, **c·∫£i thi·ªán hi·ªáu qu·∫£**, v√† **n√¢ng cao kh·∫£ nƒÉng b·∫£o tr√¨** h·ªá th·ªëng.\n\n---\n\n## 1. Package Dependencies\n\n**Package Dependencies** l√† c√°c y√™u c·∫ßu c·∫ßn thi·∫øt ƒë·ªÉ m·ªôt g√≥i ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng. N·∫øu m·ªôt g√≥i c·∫ßn th∆∞ vi·ªán ho·∫∑c c√°c g√≥i kh√°c, Yocto s·∫Ω ƒë·∫£m b·∫£o c√°c y√™u c·∫ßu n√†y ƒë∆∞·ª£c thi·∫øt l·∫≠p tr∆∞·ªõc (ho·∫∑c sau) khi build package. C√≥ hai nh√≥m ph·ª• thu·ªôc ch√≠nh:\n\n- **Build time dependencies**: Ph·ª• thu·ªôc c·∫ßn trong **qu√° tr√¨nh build** ‚Üí d√πng bi·∫øn `DEPENDS`.\n- **Run time dependencies**: Ph·ª• thu·ªôc c·∫ßn **khi ch·∫°y** ‚Üí d√πng bi·∫øn `RDEPENDS_${PN}`.\n\n### 1.1. Build time dependencies\n\nT·∫°i th·ªùi ƒëi·ªÉm build, m·ªôt s·ªë th∆∞ vi·ªán ho·∫∑c package kh√°c l√† c·∫ßn thi·∫øt ƒë·ªÉ ƒë·∫£m b·∫£o qu√° tr√¨nh build di·ªÖn ra th√†nh c√¥ng. Trong Yocto, bi·∫øn **`DEPENDS`** d√πng ƒë·ªÉ ch·ªâ ƒë·ªãnh c√°c g√≥i/th∆∞ vi·ªán c·∫ßn c√≥ trong **sysroots** tr∆∞·ªõc khi `do_compile()` ch·∫°y.\n\n#### 1.1.1. Thi·∫øt l·∫≠p m√¥i tr∆∞·ªùng\n\n```bash\n~/yocto/poky$ source oe-init-build-env\n```\n\n#### 1.1.2. T·∫°o m√£ ngu·ªìn v√† recipe\n\nT·∫°o th∆∞ m·ª•c ch·ª©a recipe **`demo-dependencies`** trong `meta-thanhdeptrai/recipes-apps`, sau ƒë√≥ th√™m source & recipe theo c·∫•u tr√∫c:\n\n```bash\n~/yocto/poky/meta-thanhdeptrai/recipes-apps$ mkdir demo-dependencies\n~/yocto/poky/meta-thanhdeptrai/recipes-apps/demo-dependencies$ tree\n.\n‚îú‚îÄ‚îÄ files\n‚îÇ   ‚îú‚îÄ‚îÄ depend_buildtime.c\n‚îÇ   ‚îú‚îÄ‚îÄ depend_runtime.c\n‚îÇ   ‚îú‚îÄ‚îÄ package_split.c\n‚îÇ   ‚îî‚îÄ‚îÄ Makefile\n‚îî‚îÄ‚îÄ demo-dependencies.bb\n```\n\n**`depend_buildtime.c`**\n\n```c\n#include <stdio.h>\n#include <curl/curl.h>\n\nint main(void)\n{\n    CURL *curl;\n    CURLcode res;\n\n    printf(\"thanhdeptrai\\n\");\n    curl = curl_easy_init();\n    if (curl) {\n        printf(\"Build dependency check: OK\\n\");\n        curl_easy_cleanup(curl);\n    }\n\n    return 0;\n}\n```\n\n**`depend_runtime.c`**\n\n```c\n#include <stdio.h>\n#include <stdlib.h>\n\nint main(void)\n{\n    printf(\"thanhdeptrai\\n\");\n    int status = system(\"bash -c 'echo This is executed by bash at runtime!'\");\n    if (status == -1) {\n        perror(\"Failed to run bash command\");\n        return 1;\n    }\n\n    return 0;\n}\n```\n\n**`package_split.c`**\n\n```c\n#include <stdio.h>\n\nint main(void)\n{\n    printf(\"thanhdeptrai: package splitting!\\n\");\n    return 0;\n}\n```\n\n**`Makefile`**\n\n```makefile\nCC = gcc\nCFLAGS = -Wall\n\nall: depend_buildtime depend_runtime package_split\n\ndepend_buildtime: depend_buildtime.c\n\t$(CC) depend_buildtime.c $(CFLAGS) -lcurl -o depend_buildtime\n\ndepend_runtime: depend_runtime.c\n\t$(CC) depend_runtime.c $(CFLAGS) -o depend_runtime\n\npackage_split: package_split.c\n\t$(CC) package_split.c $(CFLAGS) -o package_split\n\nclean:\n\trm -rf depend_buildtime package_split depend_runtime\n```\n\n**`demo-dependencies.bb`**\n\n```bitbake\nDESCRIPTION = \"Demo program showcasing package dependencies and splitting\"\nLICENSE = \"MIT\"\nLIC_FILES_CHKSUM = \"file://${COMMON_LICENSE_DIR}/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302\"\n\nS = \"${WORKDIR}\"\nSRC_URI = \"file://depend_buildtime.c \\\n           file://depend_runtime.c \\\n           file://package_split.c \\\n           file://Makefile\"\n\n# DEPENDS = \"curl\"\n\nEXTRA_OEMAKE = \"CC='${CC}' CFLAGS='${CFLAGS} -Wl,--hash-style=gnu'\"\n\ndo_compile() {\n    oe_runmake\n}\n\ndo_install() {\n    install -d ${D}${bindir}\n    install -m 0755 depend_buildtime ${D}${bindir}/depend_buildtime\n    install -m 0755 depend_runtime ${D}${bindir}/depend_runtime\n    install -m 0755 package_split ${D}${bindir}/package_split\n}\n```\n\n#### 1.1.3. Build recipe\n\n```bash\n~/yocto/poky$ bitbake demo-dependencies\n```\n\n**L·ªói th∆∞·ªùng g·∫∑p** (thi·∫øu th∆∞ vi·ªán curl):\n\n```\n| depend_buildtime.c:2:10: fatal error: curl/curl.h: No such file or directory\n|     2 | #include <curl/curl.h>\n|       |          ^~~~~~~~~~~~~\n```\n\n**Nguy√™n nh√¢n**: `DEPENDS` ch∆∞a khai b√°o `curl`, n√™n sysroots kh√¥ng c√≥ headers/lib ph·ª•c v·ª• build.  \n**Kh·∫Øc ph·ª•c**: B·ªè comment `DEPENDS = \"curl\"` trong `.bb`, r·ªìi build l·∫°i.\n\nKhi build th√†nh c√¥ng s·∫Ω th·∫•y:\n\n```\nNOTE: Tasks Summary: Attempted 3353 tasks of which 3328 didn't need to be rerun and all succeeded.\n```\n\n#### 1.1.4. Th√™m libcurl v√†o image (runtime)\n\n```conf\n# build/conf/local.conf\nIMAGE_INSTALL_append = \" libcurl\"\n```\n\n### 1.2. Run time dependencies\n\n**Run time dependencies** l√† c√°c g√≥i, th∆∞ vi·ªán ho·∫∑c c√¥ng c·ª• c·∫ßn ƒë·ªÉ ch∆∞∆°ng tr√¨nh **ch·∫°y**. Khai b√°o b·∫±ng `RDEPENDS_${PN}`.\n\n**V√≠ d·ª• l·ªói** v·ªõi `depend_runtime` do g·ªçi `bash` qua `system()` nh∆∞ng image **kh√¥ng c√≥** g√≥i `bash`:\n\n```\nsh: bash: not found\n```\n\n**Kh·∫Øc ph·ª•c** trong recipe:\n\n```bitbake\nRDEPENDS_${PN} = \"bash\"\n```\n\nV√† trong image (n·∫øu mu·ªën c√≥ s·∫µn):\n\n```conf\nIMAGE_INSTALL_append = \" bash\"\n```\n\nBuild l·∫°i image:\n\n```bash\n~/yocto/poky$ bitbake core-image-minimal\n~/yocto/poky$ runqemu qemux86-64 nographic\n```\n\nCh·∫°y l·∫°i test:\n\n```\nroot@qemux86-64:~# depend_runtime\nthanhdeptrai\nThis is executed by bash at runtime!\n```\n\n---\n\n## 2. Package Splitting\n\nTrong nhi·ªÅu tr∆∞·ªùng h·ª£p, **kh√¥ng c·∫ßn** c√†i ƒë·∫∑t to√†n b·ªô n·ªôi dung c·ªßa m·ªôt package v√†o image. ƒê·ªÉ t·ªëi ∆∞u dung l∆∞·ª£ng v√† cho ph√©p qu·∫£n l√Ω linh ho·∫°t, Yocto h·ªó tr·ª£ **chia package** th√†nh c√°c **subpackages** d√πng c√°c bi·∫øn `PACKAGES` v√† `FILES_*`.\n\n### 2.1. Recipe m·∫´u t√°ch g√≥i\n\n```bitbake\nDESCRIPTION = \"Demo program showcasing package dependencies and splitting\"\nLICENSE = \"MIT\"\nLIC_FILES_CHKSUM = \"file://${COMMON_LICENSE_DIR}/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302\"\n\nS = \"${WORKDIR}\"\nSRC_URI = \"file://depend_buildtime.c \\\n           file://depend_runtime.c \\\n           file://package_split.c \\\n           file://Makefile\"\n\nDEPENDS = \"curl\"\nRDEPENDS_${PN} = \"bash\"\nRDEPENDS_package-split = \"bash\"\n\nEXTRA_OEMAKE = \"CC='${CC}' CFLAGS='${CFLAGS} -Wl,--hash-style=gnu'\"\n\n# Khai b√°o c√°c package con\nPACKAGES =+ \"demo-tools package-split\"\n\n# G·ªôp depend_buildtime v√† depend_runtime v√†o package demo-tools\nFILES_demo-tools = \"${bindir}/depend_buildtime \\\n                    ${bindir}/depend_runtime\"\n\n# Khai b√°o package ri√™ng cho package_split\nFILES_package-split = \"${bindir}/package_split\"\n\ndo_compile() {\n    oe_runmake\n}\n\ndo_install() {\n    install -d ${D}${bindir}\n    install -m 0755 depend_buildtime ${D}${bindir}/depend_buildtime\n    install -m 0755 depend_runtime ${D}${bindir}/depend_runtime\n    install -m 0755 package_split ${D}${bindir}/package_split\n}\n```\n\n### 2.2. Gi·∫£i th√≠ch\n\n- `PACKAGES =+ \"demo-tools package-split\"`: khai b√°o th√™m **hai** subpackages.\n- `FILES_demo-tools`: gom **`depend_buildtime`** & **`depend_runtime`** v√†o c√πng m·ªôt subpackage **demo-tools**.\n- `FILES_package-split`: t√°ch **`package_split`** th√†nh g√≥i ri√™ng **package-split**.\n- `RDEPENDS_package-split = \"bash\"`: n·∫øu subpackage c·∫ßn ph·ª• thu·ªôc runtime ri√™ng, c√≥ th·ªÉ khai b√°o t·∫°i ƒë√¢y.\n- Khi build, BitBake s·∫Ω sinh ra nhi·ªÅu g√≥i (ipk/deb/rpm) t∆∞∆°ng ·ª©ng v·ªõi t·ª´ng subpackage.\n\n### 2.3. C√†i ƒë·∫∑t c√≥ ch·ªçn l·ªçc\n\nCh·ªâ mu·ªën c√†i **demo-tools** (kh√¥ng c√†i `package-split`) v√†o image:\n\n```conf\nIMAGE_INSTALL_append = \" demo-tools\"\n```\n\nBuild & ch·∫°y:\n\n```bash\nbitbake core-image-minimal\nrunqemu qemux86-64 nographic\n```\n\nKi·ªÉm th·ª≠:\n\n```\nroot@qemux86-64:~# depend_buildtime\nthanhdeptrai\nBuild dependency check: OK\n\nroot@qemux86-64:~# depend_runtime\nthanhdeptrai\nThis is executed by bash at runtime!\n\nroot@qemux86-64:~# package_split\n-sh: package_split: command not found\n```\n\n---\n\n## 3. K·∫øt lu·∫≠n\n\n- **Package Dependencies** ƒë·∫£m b·∫£o c√°c g√≥i/th∆∞ vi·ªán c·∫ßn thi·∫øt c√≥ m·∫∑t ƒë√∫ng l√∫c (build-time qua `DEPENDS`, runtime qua `RDEPENDS_*`).  \n- **Package Splitting** cho ph√©p chia nh·ªè g√≥i th√†nh c√°c **subpackage** ƒë·ªÉ **t·ªëi ∆∞u dung l∆∞·ª£ng** v√† **c√†i ƒë·∫∑t linh ho·∫°t**.  \n- √Åp d·ª•ng ƒë√∫ng `DEPENDS`, `RDEPENDS_*`, `PACKAGES`, `FILES_*` gi√∫p h·ªá th·ªëng **·ªïn ƒë·ªãnh**, **nh·∫π**, v√† **d·ªÖ b·∫£o tr√¨**.\n"}, {"id": "content/7-build-sdk-b-ng-yocto.md", "title": "H∆∞·ªõng d·∫´n Build & S·ª≠ d·ª•ng **SDK Yocto** cho **Raspberry Pi 4 (raspberrypi4-64)**", "body": "# H∆∞·ªõng d·∫´n Build & S·ª≠ d·ª•ng **SDK Yocto** cho **Raspberry Pi 4 (raspberrypi4-64)**\n\nT√†i li·ªáu n√†y chuy·ªÉn th·ªÉ t·ª´ b√†i vi·∫øt SDK t·ªïng quan v√† **ƒë∆∞·ª£c ƒëiu ch·ªânh cho Raspberry Pi 4 (ARM64)**.  \nB·∫°n s·∫Ω bi·∫øt c√°ch **t·∫°o SDK chu·∫©n / eSDK**, **c√†i ƒë·∫∑t**, **thi·∫øt l·∫≠p m√¥i tr∆∞ng**, v√† **bi√™n d·ªãch th·ª≠** m·ªôt ·ª©ng d·ª•ng v·ªõi toolchain ch√©o.\n\n---\n\n## 1) SDK trong Yocto l√† g√¨?\n**SDK (Software Development Kit)** cung c·∫•p:\n\n- **Cross toolchain**: bi√™n d·ªãch tr√™n host (x86_64) ra binary cho **RPi4 (ARM64)**.  \n- **Sysroots**: header & th∆∞ vi·ªán t∆∞∆°ng ·ª©ng.  \n- **Script thi·∫øt l·∫≠p m√¥i tr∆∞ng**: ƒë·∫∑t bi·∫øn `PATH`, `CC`, `CXX`, `PKG_CONFIG_PATH`, v.v.\n\n> V·ªõi **Raspberry Pi 4**, khuy·∫øn ngh·ªã d√πng m√°y 64-bit v√† **MACHINE = `raspberrypi4-64`** ƒë·ªÉ nh·∫≠n **toolchain aarch64**.\n\n---\n\n## 2) Chu·∫©n b·ªã d·ª± √°n Yocto cho RPi 4\nT·∫°o workspace v√† clone c√°c layer (v√≠ d·ª• nh√°nh *dunfell* ƒë·ªÉ ƒë·ªìng b·ªô h∆∞·ªõng d·∫´n):\n\n```bash\nmkdir -p ~/yocto && cd ~/yocto\n\n# Poky (dunfell v√≠ d·ª•)\ngit clone -b dunfell git://git.yoctoproject.org/poky\ncd poky\n\n# Layer Raspberry Pi + OpenEmbedded\ngit clone -b dunfell git://git.yoctoproject.org/meta-raspberrypi\ngit clone -b dunfell git://git.openembedded.org/meta-openembedded\n\n# Thi·∫øt l·∫≠p m√¥i tr∆∞ng build\nsource oe-init-build-env\n```\n\nC·∫≠p nh·∫≠t **`conf/bblayers.conf`** ƒë·ªÉ th√™m layer:\n```conf\nBBLAYERS ?= \" \\\n  /home/<user>/yocto/poky/meta \\\n  /home/<user>/yocto/poky/meta-poky \\\n  /home/<user>/yocto/poky/meta-yocto-bsp \\\n  /home/<user>/yocto/poky/meta-raspberrypi \\\n  /home/<user>/yocto/poky/meta-openembedded/meta-oe \\\n\"\n```\n> ·ªïi `<user>` cho ph√π h·ª£p ƒë∆∞ng d·∫´n m√°y b·∫°n.\n\nC·∫≠p nh·∫≠t **`conf/local.conf`** (ph·∫ßn quan trng):\n```conf\nMACHINE ?= \"raspberrypi4-64\"   # ARM64 cho Raspberry Pi 4\nPACKAGE_CLASSES ?= \"package_rpm\"\n# (tu·ª≥ chn) t·ªëi ∆∞u dung l∆∞·ª£ng: INHERIT += \"rm_work\"\n```\n\n---\n\n## 3) C√°c c√°ch **t·∫°o SDK**\n\n### C√°ch A ‚Äî Th√™m toolchain v√†o **image** (ph√°t tri·ªÉn **tr·ª±c ti·∫øp tr√™n target**)\nTrong `conf/local.conf`:\n```conf\nEXTRA_IMAGE_FEATURES ?= \"tools_sdk\"\n```\nR·ªìi build image:\n```bash\nbitbake core-image-minimal\n```\n> C√°ch n√†y c√†i **gcc/make/headers** v√†o **Raspberry Pi 4**. Ph√π h·ª£p demo nhanh tr√™n target nh∆∞ng **kh√¥ng khuy·∫øn ngh·ªã** cho s·∫£n xu·∫•t do gi·ªõi h·∫°n t√†i nguy√™n.\n\n### C√°ch B ‚Äî T·∫°o **Standard SDK** (khuy·∫øn ngh·ªã)\nT·∫°o **file c√†i ƒë·∫∑t SDK** tr√™n host:\n```bash\nbitbake core-image-minimal -c populate_sdk\n```\nSau khi xong, t√¨m trong:\n```\nbuild/tmp/deploy/sdk/\n```\nB·∫°n s·∫Ω th·∫•y file d·∫°ng:\n```\npoky-glibc-x86_64-core-image-minimal-*-raspberrypi4-64-toolchain-<ver>.sh\n```\n> T√™n th·∫≠t c√≥ th·ªÉ kh√°c ƒë√¥i ch√∫t theo c·∫•u h√¨nh. C·ª© d·ª±a **m·∫´u c√≥ `raspberrypi4-64`** l√† ƒë√∫ng.\n\n### C√°ch C ‚Äî T·∫°o **Extensible SDK (eSDK)**\n```bash\nbitbake core-image-minimal -c populate_sdk_ext\n```\n**eSDK** bao g·ªìm devtool v√† metadata, ti·ªán cho vi·ªác **s·ª≠a recipe, th·ª≠ nghi·ªám, c·∫≠p nh·∫≠t** ngay tr√™n host.\n\n---\n\n## 4) C√†i ƒë·∫∑t & Thi·∫øt l·∫≠p m√¥i tr∆∞ng SDK tr√™n host\n\n### 4.1 C√†i ƒë·∫∑t\nCh·∫°y script `.sh` trong th∆∞ m·ª•c `deploy/sdk`:\n```bash\ncd build/tmp/deploy/sdk/\n./poky-glibc-x86_64-core-image-minimal-*-raspberrypi4-64-toolchain-*.sh\n```\n- Chn n∆°i c√†i (m·∫∑c ƒë·ªãnh th∆∞ng l√† `/opt/poky/<ver>`).\n\n### 4.2 N·∫°p bi·∫øn m√¥i tr∆∞ng (quan trng)\nT√¨m **script environment** cho **aarch64** r·ªìi `source`:\n```bash\n# g·ª£i √Ω t√¨m nhanh\nls /opt/poky/*/environment-setup-*aarch64*\n\n# v√≠ d·ª• (t√™n th·ª±c t·∫ø c√≥ th·ªÉ kh√°c nhau)\nsource /opt/poky/3.1.33/environment-setup-aarch64-poky-linux\n```\nKi·ªÉm tra nhanh:\n```bash\necho \"$CC\"\n$CC --version\n```\nB·∫°n n√™n th·∫•y toolchain **`aarch64-poky-linux-gcc`**.\n\n---\n\n## 5) Th·ª≠ nghi·ªám SDK b·∫±ng ·ª©ng d·ª•ng C ƒë∆°n gi·∫£n\n\n### 5.1 Vi·∫øt m√£ ngu·ªìn\nT·∫°o file `~/hello_SDK.c`:\n```c\n#include <stdio.h>\n\nint main(void) {\n    printf(\"thanhdeptrai: hello SDK for Raspberry Pi 4 (aarch64)!\\n\");\n    return 0;\n}\n```\n\n### 5.2 Bi√™n d·ªãch b·∫±ng cross toolchain\n```bash\n# ·∫£m b·∫£o b·∫°n ƒë√£ 'source environment-setup-aarch64-poky-linux'\n$CC -o ~/hello_SDK_app ~/hello_SDK.c\n```\n\n### 5.3 Ch√©p v√† ch·∫°y tr√™n target\n**C√°ch 1 ‚Äî SSH t·ªõi Raspberry Pi 4 th·ª±c t·∫ø**\n```bash\n# thay 192.168.x.x l√† IP c·ªßa Pi 4\nscp ~/hello_SDK_app root@192.168.x.x:/home/root/\nssh root@192.168.x.x\n/home/root/hello_SDK_app\n```\n**C√°ch 2 ‚Äî N·∫øu b·∫°n ƒëang d√πng QEMU aarch64**\n```bash\nscp ~/hello_SDK_app root@<qemu-ip>:/home/root/\nssh root@<qemu-ip> /home/root/hello_SDK_app\n```\n\nK·∫øt qu·∫£ mong ƒë·ª£i:\n```\nthanhdeptrai: hello SDK for Raspberry Pi 4 (aarch64)!\n```\n\n---\n\n## 6) M·∫πo & T√πy bi·∫øn SDK\n\n- **Chn image kh√°c**: SDK ph·ª• thu·ªôc v√†o image (v√≠ d·ª• `core-image-sato` n·∫øu c·∫ßn ƒë·ªì ha).\n- **Th√™m g√≥i v√†o SDK** (khi t·∫°o):\n  ```conf\n  # conf/local.conf ho·∫∑c distro/layer\n  TOOLCHAIN_TARGET_TASK += \" packageA packageB \"\n  TOOLCHAIN_HOST_TASK   += \" nativesdk-cmake nativesdk-pkgconfig \"\n  ```\n- **eSDK + devtool**: ti·ªán cho quy tr√¨nh ch·ªânh s·ª≠a recipe, `devtool modify`, `devtool build`, `devtool update-recipe` ngay tr√™n host.\n\n---\n\n## 7) L·ª£i √≠ch ch√≠nh khi d√πng SDK\n- **Nhanh & gn**: Kh√¥ng ph·∫£i rebuild to√†n b·ªô image khi ch·ªânh ·ª©ng d·ª•ng.  \n- **Nh·∫•t qu√°n**: Toolchain/headers gi·ªëng target ‚Üí √≠t l·ªói ‚Äúkh√°c m√¥i tr∆∞ng.  \n- **Th√¢n thi·ªán IDE**: D√πng VS Code, CLion‚Ä¶ v·ªõi toolchain aarch64.  \n- **Ti·∫øt ki·ªám t√†i nguy√™n target**: Build tr√™n host, kh√¥ng l√†m n·∫∑ng Pi 4.\n\n---\n\n## 8) T√≥m t·∫Øt nhanh c√°c l·ªánh quan trng\n\n```bash\n# Chu·∫©n b·ªã & c·∫•u h√¨nh cho RPi4 (ARM64)\nsource oe-init-build-env\n# (s·ª≠a local.conf: MACHINE ?= \"raspberrypi4-64\")\n\n# T·∫°o SDK chu·∫©n\nbitbake core-image-minimal -c populate_sdk\n\n# T·∫°o eSDK\nbitbake core-image-minimal -c populate_sdk_ext\n\n# C√†i ƒë·∫∑t SDK\ncd build/tmp/deploy/sdk/\n./poky-glibc-x86_64-core-image-minimal-*-raspberrypi4-64-toolchain-*.sh\n\n# N·∫°p m√¥i tr∆∞ng cross-compile\nsource /opt/poky/*/environment-setup-aarch64-poky-linux\n\n# Build app m·∫´u\n$CC -o ~/hello_SDK_app ~/hello_SDK.c\n```\n\n---\n\n### Ghi ch√∫ t∆∞∆°ng th√≠ch\n- V√≠ d·ª• nh√°nh **dunfell (3.1.x)** ph·ªï bi·∫øn v·ªõi c·ªông ƒë·ªìng RPi, nh∆∞ng b·∫°n c√≥ th·ªÉ d√πng b·∫£n m·ªõi h∆°n (kirkstone/nanbield...) mi·ªÖn layer t∆∞∆°ng th√≠ch.  \n- T√™n file SDK `.sh` v√† script `environment-setup-*` **c√≥ th·ªÉ kh√°c** theo **distro/TCLIBC/MACHINE**; d√πng `ls` ƒë·ªÉ d√≤ ƒë√∫ng t√™n.\n\nCh√∫c b·∫°n build SDK th√†nh c√¥ng v√† code ‚Äúm∆∞·ª£t cho **Raspberry Pi 4**! üöÄ\n"}, {"id": "content/8-build-image-cho-raspberry-pi-4.md", "title": "X√¢y d·ª±ng Image cho **Raspberry Pi 4** v·ªõi Yocto Project", "body": "# X√¢y d·ª±ng Image cho **Raspberry Pi 4** v·ªõi Yocto Project\n\nYocto Project l√† m·ªôt c√¥ng c·ª• m·∫°nh m·∫Ω cho ph√©p t·∫°o ra c√°c h·ªá th·ªëng Linux t√πy ch·ªânh cho c√°c thi·∫øt b·ªã nh√∫ng. T√†i li·ªáu n√†y h∆∞·ªõng d·∫´n b·∫°n x√¢y d·ª±ng **image ho√†n ch·ªânh cho Raspberry Pi 4** (1/2/4/8GB).\n\n---\n\n## 1. Chu·∫©n b·ªã m√¥i tr∆∞·ªùng\n\n### 1.1. Y√™u c·∫ßu ph·∫ßn c·ª©ng v√† ph·∫ßn m·ªÅm\nTr∆∞·ªõc khi b·∫Øt ƒë·∫ßu, h√£y ƒë·∫£m b·∫£o b·∫°n c√≥:\n- **M√°y host**: Ubuntu (khuy·∫øn ngh·ªã ch·∫°y tr√™n VMware/metal) v·ªõi **‚â• 100GB** tr·ªëng.\n- **Thi·∫øt b·ªã**: **Raspberry Pi 4**.\n- **B·ªô nh·ªõ**: th·∫ª **microSD ‚â• 16GB** (khuy·∫øn ngh·ªã UHS-I/SDHC t·ªët).\n- **K·∫øt n·ªëi Internet**: t·∫£i package v√† source code.\n\n### 1.2. C√†i ƒë·∫∑t c√°c package c·∫ßn thi·∫øt (Ubuntu/Debian)\n```bash\nsudo apt update\nsudo apt install gawk wget git diffstat unzip texinfo gcc build-essential chrpath socat \\\n  cpio python3 python3-pip python3-pexpect xz-utils debianutils iputils-ping \\\n  python3-git python3-jinja2 python3-subunit zstd liblz4-tool file locales libacl1\n```\n\n> N·∫øu d√πng Fedora/CentOS, b·∫°n c√≥ th·ªÉ c√†i c√°c g√≥i t∆∞∆°ng ƒë∆∞∆°ng theo distro ƒë√≥.\n\n---\n\n## 2. Thi·∫øt l·∫≠p m√¥i tr∆∞·ªùng Yocto\n\n### 2.1. T·∫£i c√°c meta-layer c·∫ßn thi·∫øt\nTrong v√≠ d·ª• n√†y d√πng nh√°nh **dunfell** ƒë·ªÉ ƒë·ªìng b·ªô v·ªõi c√°c h∆∞·ªõng d·∫´n c·ªï ƒëi·ªÉn (b·∫°n c√≥ th·ªÉ ch·ªçn nh√°nh kh√°c ƒë·ªìng b·ªô gi·ªØa t·∫•t c·∫£ layer).\n\n```bash\nmkdir -p ~/yocto\ncd ~/yocto\n\n# Poky (Yocto reference distro)\ngit clone -b dunfell git://git.yoctoproject.org/poky\ncd poky\n\n# Layer cho Raspberry Pi\ngit clone -b dunfell git://git.yoctoproject.org/meta-raspberrypi\n\n# OpenEmbedded layer b·ªï sung\ngit clone -b dunfell git://git.openembedded.org/meta-openembedded\n```\n\n### 2.2. Kh·ªüi t·∫°o m√¥i tr∆∞·ªùng build\n```bash\ncd ~/yocto/poky\nsource oe-init-build-env\n```\nSau l·ªánh tr√™n, th∆∞ m·ª•c **build/** v√† c√°c file c·∫•u h√¨nh s·∫Ω ƒë∆∞·ª£c t·∫°o.\n\n### 2.3. C·∫•u h√¨nh build\n\n#### 2.3.1. S·ª≠a `conf/local.conf`\nM·ªü `build/conf/local.conf` v√† ƒëi·ªÅu ch·ªânh:\n```conf\n# Ch·ªçn m√°y ƒë√≠ch: Raspberry Pi 4 (ARM64)\nMACHINE ??= \"raspberrypi4-64\"\n\n# (Tu·ª≥ ch·ªçn) ti·∫øt ki·ªám dung l∆∞·ª£ng, x√≥a work sau khi ho√†n t·∫•t\nINHERIT += \"rm_work\"\n\n# (Tu·ª≥ ch·ªçn) th√™m c√¥ng c·ª• ti·ªán √≠ch khi debug\nEXTRA_IMAGE_FEATURES ?= \"debug-tweaks\"\n\n# (Tu·ª≥ ch·ªçn) Wi-Fi/Bluetooth & firmware th∆∞·ªùng d√πng tr√™n RPi4\n# IMAGE_INSTALL:append = \" linux-firmware-brcm43455 pi-bluetooth iw wpa-supplicant bluez5\"\n```\n\n#### 2.3.2. Th√™m meta-layer v√†o `conf/bblayers.conf`\nB·ªï sung **meta-raspberrypi** v√† **meta-openembedded/meta-oe** (ch·ªânh s·ª≠a ƒë∆∞·ªùng d·∫´n theo m√°y c·ªßa b·∫°n):\n```conf\nBBLAYERS ?= \" \\\n  /home/<user>/yocto/poky/meta \\\n  /home/<user>/yocto/poky/meta-poky \\\n  /home/<user>/yocto/poky/meta-yocto-bsp \\\n  /home/<user>/yocto/poky/meta-raspberrypi \\\n  /home/<user>/yocto/poky/meta-openembedded/meta-oe \\\n\"\n```\n> Thay `</user>` b·∫±ng t√™n ng∆∞·ªùi d√πng/ƒë∆∞·ªùng d·∫´n th·ª±c t·∫ø.\n\n---\n\n## 3. Build v√† flash image\n\n### 3.1. Ti·∫øn h√†nh build\nV√≠ d·ª• build image c√≥ giao di·ªán **Sato** (b·∫°n c√≥ th·ªÉ d√πng `core-image-minimal` n·∫øu mu·ªën console t·ªëi gi·∫£n):\n```bash\ncd ~/yocto/poky\nbitbake core-image-sato\n```\n> Th·ªùi gian build ph·ª• thu·ªôc CPU/RAM/SSD/M·∫°ng. L·∫ßn ƒë·∫ßu c√≥ th·ªÉ l√¢u; c√°c l·∫ßn sau nhanh h∆°n nh·ªù sstate-cache.\n\n### 3.2. V·ªã tr√≠ image ƒë·∫ßu ra\nSau khi build xong, image ƒë∆∞·ª£c ƒë·∫∑t t·∫°i:\n```\n~/yocto/poky/build/tmp/deploy/images/raspberrypi4-64/\n```\n\n### 3.3. Flash image v√†o th·∫ª nh·ªõ\n\n**(1) X√°c ƒë·ªãnh thi·∫øt b·ªã th·∫ª nh·ªõ**\n```bash\nlsblk\n```\n\n**(2) Gi·∫£i n√©n image v√† ghi v√†o th·∫ª**\nV√≠ d·ª• v·ªõi file `.wic.bz2` sinh ra t·ª´ b∆∞·ªõc build:\n```bash\ncd ~/yocto/poky/build/tmp/deploy/images/raspberrypi4-64/\n\n# Ch·ªçn ƒë√∫ng file .wic.bz2 c·ªßa b·∫°n\ncp core-image-sato-raspberrypi4-64-*.wic.bz2 temp.wic.bz2\nbzip2 -d temp.wic.bz2\n\n# C·∫¢NH B√ÅO: thay /dev/sdX b·∫±ng thi·∫øt b·ªã th·∫ª nh·ªõ CH√çNH X√ÅC! (v√≠ d·ª• /dev/sdb)\nsudo dd if=temp.wic of=/dev/sdX bs=4M status=progress conv=fsync\nsync\n```\n\n> (Khuy·∫øn ngh·ªã) N·∫øu c√≥ file `.bmap`, d√πng **bmaptool** s·∫Ω nhanh h∆°n v√† an to√†n h∆°n:\n> ```bash\n> sudo apt install bmap-tools\n> sudo bmaptool copy core-image-sato-raspberrypi4-64-*.wic.bz2 /dev/sdX\n> ```\n\n### 3.4. Kh·ªüi ƒë·ªông Raspberry Pi 4\n- C·∫Øm th·∫ª microSD v√†o **Raspberry Pi 4**, c·∫•p ngu·ªìn.\n- K·∫øt n·ªëi **HDMI** (ƒë·ªÉ xem ƒë·ªì h·ªça) ho·∫∑c **UART/SSH** (image console).\n- N·∫øu b·∫≠t `debug-tweaks`, th∆∞·ªùng c√≥ th·ªÉ ƒëƒÉng nh·∫≠p `root` (kh√¥ng m·∫≠t kh·∫©u) ·ªü tty c·ª•c b·ªô.\n- (Tu·ª≥ ch·ªçn) C·∫•u h√¨nh Wi‚ÄëFi v·ªõi `wpa_supplicant`:\n  ```bash\n  # V√≠ d·ª• nhanh:\n  cat <<'EOF' > /etc/wpa_supplicant/wpa_supplicant.conf\n  ctrl_interface=/var/run/wpa_supplicant\n  update_config=1\n  country=US\n\n  network={\n      ssid=\"Ten_WIFI\"\n      psk=\"Mat_khau_WIFI\"\n      key_mgmt=WPA-PSK\n  }\n  EOF\n\n  # K√≠ch ho·∫°t (tu·ª≥ theo init system c·ªßa image)\n  wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf\n  udhcpc -i wlan0  # ho·∫∑c dhclient, ho·∫∑c systemd-networkd t√πy image\n  ```\n\n---\n\n## 4. K·∫øt lu·∫≠n\nV·ªõi h∆∞·ªõng d·∫´n n√†y, b·∫°n ƒë√£ chuy·ªÉn t·ª´ h∆∞·ªõng d·∫´n d√†nh cho **Raspberry Pi Zero W** sang **Raspberry Pi 4**:\n- Thi·∫øt l·∫≠p meta-layer ph√π h·ª£p (**meta-raspberrypi**, **meta-openembedded**)\n- C·∫•u h√¨nh `MACHINE ??= \"raspberrypi4-64\"`\n- Build image (**core-image-sato** ho·∫∑c **core-image-minimal**)\n- Flash v√† kh·ªüi ƒë·ªông tr√™n ph·∫ßn c·ª©ng th·ª±c\n\nB·∫°n c√≥ th·ªÉ ti·∫øp t·ª•c tu·ª≥ bi·∫øn image, th√™m package/firmware, ho·∫∑c t√≠ch h·ª£p CI/CD theo nhu c·∫ßu d·ª± √°n.\n"}, {"id": "content/9-quy-tr-nh-ph-t-tri-n-kernel-trong-yocto-project.md", "title": "Ph√°t tri·ªÉn Kernel cho **Raspberry Pi 4** v·ªõi Yocto Project (core-image-sato)", "body": "# Ph√°t tri·ªÉn Kernel cho **Raspberry Pi 4** v·ªõi Yocto Project (core-image-sato)\n\nPh√°t tri·ªÉn v√† t√πy ch·ªânh kernel Linux l√† m·ªôt nhi·ªám v·ª• quan trng trong h·ªá th·ªëng nh√∫ng. Yocto Project cung c·∫•p quy tr√¨nh c√≥ c·∫•u tr√∫c ƒë·ªÉ qu·∫£n l√Ω, v√° (patch), t√πy bi·∫øn v√† build kernel cho thi·∫øt b·ªã. T√†i li·ªáu n√†y h∆∞·ªõng d·∫´n **th√™m m·ªôt kernel module m·∫´u** ƒë·ªÉ ƒëiu khi·ªÉn LED qua GPIO27 tr√™n **Raspberry Pi 4 (BCM2711, 64-bit)** v√† t√≠ch h·ª£p v√†o image **`core-image-sato`**.\n\n> üí° Y√™u c·∫ßu: b·∫°n ƒë√£ c√≥ m√¥i tr∆∞ng Yocto v·ªõi `meta-raspberrypi` v√† ƒëang build cho **MACHINE = raspberrypi4-64**.\n\n---\n\n## 1) T·ªïng quan Kernel trong Yocto\n\nTrong Yocto, kernel ƒë∆∞·ª£c build th√¥ng qua **recipe** (ƒë·∫∑t trong `meta/*/recipes-kernel/linux/`). C√≥ v√†i ngu·ªìn/kernel base th∆∞ng d√πng:\n\n* **Kernel chu·∫©n** t·ª´ kernel.org\n* **Kernel nh√† cung c·∫•p** (v√≠ d·ª• Raspberry Pi Foundation)\n* **Kernel t√πy ch·ªânh** (fork/nh√°nh ri√™ng)\n\nYocto khuy·∫øn kh√≠ch qu·∫£n l√Ω thay ƒë·ªïi kernel b·∫±ng **patch** (git) v√†/ho·∫∑c **config fragment**, nh·∫±m ƒë·∫£m b·∫£o kh·∫£ nƒÉng t√°i t·∫°o (reproducibility).\n\n---\n\n## 2) Quy tr√¨nh t√≠ch h·ª£p module m·∫´u (GPIO27)\n\nM·ª•c ti√™u: th√™m module **`mgpio`** ƒë·ªÉ set GPIO27 **HIGH** khi n·∫°p module, v√† **LOW** khi remove.\n\n### 2.1) C·∫•u tr√∫c module\n\n```\nmgpio/\n‚îú‚îÄ‚îÄ Kconfig\n‚îú‚îÄ‚îÄ Makefile\n‚îî‚îÄ‚îÄ mgpio.c\n```\n\n**`mgpio.c`**\n\n```c\n#include <linux/module.h>\n#include <linux/gpio.h>\n\n#define GPIO_NUMBER_27  27\n#define LOW  0\n#define HIGH 1\n\nstatic int __init mgpio_driver_init(void)\n{\n    /* C·∫•p quyn v√† set GPIO27 l√†m output */\n    gpio_request(GPIO_NUMBER_27, \"gpio_27\");\n    gpio_direction_output(GPIO_NUMBER_27, LOW);\n\n    /* Set GPIO27 HIGH */\n    gpio_set_value(GPIO_NUMBER_27, HIGH);\n    pr_info(\"mgpio: GPIO27 set to HIGH, status: %d\\n\", gpio_get_value(GPIO_NUMBER_27));\n    return 0;\n}\n\nstatic void __exit mgpio_driver_exit(void)\n{\n    /* Tr·∫£ GPIO27 v LOW tr∆∞·ªõc khi ri */\n    gpio_set_value(GPIO_NUMBER_27, LOW);\n    gpio_free(GPIO_NUMBER_27);\n    pr_info(\"mgpio: GPIO27 set to LOW (module exit)\\n\");\n}\n\nmodule_init(mgpio_driver_init);\nmodule_exit(mgpio_driver_exit);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"thanhdeptrai\");\nMODULE_DESCRIPTION(\"GPIO Driver for Raspberry Pi 4 (BCM2711)\");\n```\n\n**`Makefile`**\n\n```make\nEXTRA_CFLAGS = -Wall\nobj-$(CONFIG_MGPIO) = mgpio.o\n```\n\n**`Kconfig`**\n\n```Kconfig\nmenu \"mgpio device driver\"\n\nconfig MGPIO\n    tristate \"mgpio device driver\"\n    depends on ARM64 || ARM\n    help\n      Simple demo driver: set GPIO27 HIGH on load, LOW on unload.\n\nendmenu\n```\n\n> üìå L∆∞u √Ω: Tr√™n kernel m·ªõi API GPIO legacy c√≥ th·ªÉ ƒë√£ b·ªã c·∫£nh b√°o/khuy√™n d√πng gpiod.  ƒë√¢y d√πng API c≈© cho m·ª•c ƒë√≠ch demo t·ªëi gi·∫£n.\n\n---\n\n### 2.2) Thi·∫øt l·∫≠p m√¥i tr∆∞ng\n\n```bash\n# Trong c√¢y ngu·ªìn Poky\nsource oe-init-build-env\n\n# ·∫£m b·∫£o MACHINE l√† Raspberry Pi 4 (64-bit)\n# poky/build/conf/local.conf\n# MACHINE ?= \"raspberrypi4-64\"\n```\n\n---\n\n### 2.3) Tr√≠ch xu·∫•t ngu·ªìn kernel b·∫±ng devtool\n\n```bash\ncd ~/yocto/poky/build\ndevtool modify virtual/kernel\n```\n\n* M√£ ngu·ªìn kernel s·∫Ω xu·∫•t hi·ªán ·ªü:\n  `build/workspace/sources/linux-raspberrypi`\n\nT·∫°o th∆∞ m·ª•c module v√† th√™m 3 file ·ªü tr√™n:\n\n```bash\ncd workspace/sources/linux-raspberrypi\nmkdir -p drivers/mgpio\n# ƒë·∫∑t Kconfig, Makefile, mgpio.c v√†o drivers/mgpio/\n```\n\n---\n\n### 2.4) Khai b√°o module v·ªõi kernel tree\n\n**S·ª≠a `drivers/Makefile`** (th√™m d√≤ng n√†y cu·ªëi file):\n\n```make\nobj-$(CONFIG_MGPIO) += mgpio/\n```\n\n**S·ª≠a `drivers/Kconfig`** (th√™m d√≤ng n√†y cu·ªëi file):\n\n```Kconfig\nsource \"drivers/mgpio/Kconfig\"\n```\n\n---\n\n### 2.5) B·∫≠t c·∫•u h√¨nh module trong defconfig\n\n·ªëi v·ªõi **Raspberry Pi 4 / ARM64**, c·∫≠p nh·∫≠t defconfig t∆∞∆°ng ·ª©ng (th∆∞ng l√† **`arch/arm64/configs/bcm2711_defconfig`**):\n\n```diff\n+ CONFIG_MGPIO=m\n```\n\n> N·∫øu d·ª± √°n c·ªßa b·∫°n d√πng defconfig t√™n kh√°c, h√£y ch·ªânh ƒë√∫ng file d∆∞·ªõi `arch/arm64/configs/‚Ä¶`.\n> (C√°ch thay th·∫ø n√¢ng cao: d√πng **config fragment** thay v√¨ s·ª≠a defconfig tr·ª±c ti·∫øp.)\n\n---\n\n### 2.6) T·∫°o patch t·ª´ thay ƒë·ªïi\n\n```bash\ncd workspace/sources/linux-raspberrypi\ngit add drivers/mgpio/ drivers/Kconfig drivers/Makefile arch/arm64/configs/bcm2711_defconfig\ngit commit -m \"Add mgpio driver (GPIO27) for Raspberry Pi 4 (BCM2711)\"\ngit format-patch -1\n```\n\nPatch v·ª´a t·∫°o c√≥ d·∫°ng `0001-Add-mgpio-driver-‚Ä¶.patch`.\n\n---\n\n### 2.7) ∆∞a patch v√†o meta-layer c·ªßa b·∫°n\n\nT·∫°o th∆∞ m·ª•c trong layer t√πy ch·ªânh, v√≠ d·ª• `meta-thanhdeptrai`:\n\n```bash\nmkdir -p ../../meta-thanhdeptrai/recipes-kernel/linux/linux-raspberrypi\ncp 0001-Add-mgpio-driver-*.patch ../../meta-thanhdeptrai/recipes-kernel/linux/linux-raspberrypi/\n```\n\nT·∫°o **`linux-raspberrypi_%.bbappend`**:\n\n```\nmeta-thanhdeptrai/\n‚îî‚îÄ‚îÄ recipes-kernel/\n    ‚îî‚îÄ‚îÄ linux/\n        ‚îú‚îÄ‚îÄ linux-raspberrypi/\n        ‚îÇ   ‚îî‚îÄ‚îÄ 0001-Add-mgpio-driver-*.patch\n        ‚îî‚îÄ‚îÄ linux-raspberrypi_%.bbappend\n```\n\n**`linux-raspberrypi_%.bbappend`**\n\n```bitbake\nFILESEXTRAPATHS:prepend := \"${THISDIR}/${PN}:\"\n\n# Th√™m patch v√†o SRC_URI\nSRC_URI += \"file://0001-Add-mgpio-driver-*.patch\"\n\n# T·ª± ƒë·ªông n·∫°p module khi boot (t√πy chn)\nKERNEL_MODULE_AUTOLOAD += \"mgpio\"\n```\n\n---\n\n### 2.8) Build kernel (v√†/ho·∫∑c image)\n\n```bash\n# Ch·ªâ build kernel\nbitbake virtual/kernel\n\n# Ho·∫∑c build image m·ª•c ti√™u (t·ª± k√©o kernel m·ªõi)\nbitbake core-image-sato\n```\n\nSau khi build image, flash ra th·∫ª microSD nh∆∞ b√¨nh th∆∞ng. N·∫øu d√πng `KERNEL_MODULE_AUTOLOAD`, module **mgpio** s·∫Ω t·ª± load khi kh·ªüi ƒë·ªông (GPIO27 s·∫Ω ·ªü m·ª©c HIGH). N·∫øu kh√¥ng, c√≥ th·ªÉ th·ª≠ th·ªß c√¥ng:\n\n```bash\n# Tr√™n thi·∫øt b·ªã:\nmodprobe mgpio\ndmesg | tail -n 50\n# ... ki·ªÉm tra log \"GPIO27 set to HIGH ...\"\nrmmod mgpio\n```\n\n---\n\n## 3) K·∫øt lu·∫≠n\n\nB·∫°n v·ª´a th√™m m·ªôt **kernel module t√πy ch·ªânh** v√†o kernel **Raspberry Pi 4 (BCM2711, ARM64)** trong Yocto b·∫±ng quy tr√¨nh ti√™u chu·∫©n:\n\n* S·ª≠a code trong **workspace** qua `devtool modify virtual/kernel`\n* Commit v√† **t·∫°o patch**\n* Th√™m **.bbappend** + **patch** v√†o **meta-layer** ri√™ng\n* Build l·∫°i **kernel/image**\n\nC√°ch l√†m n√†y ƒë·∫£m b·∫£o thay ƒë·ªïi ƒë∆∞·ª£c qu·∫£n l√Ω s·∫°ch s·∫Ω, **t√°i t·∫°o ƒë∆∞·ª£c** v√† d·ªÖ chia s·∫ª trong nh√≥m. T·ª´ v√≠ d·ª• `mgpio`, b·∫°n c√≥ th·ªÉ m·ªü r·ªông ƒë·ªÉ t√≠ch h·ª£p driver th·∫≠t c·ªßa d·ª± √°n, th√™m config fragments, ho·∫∑c chia nh patch theo best practices.\n"}]